<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Papel e Arte - Point of Sale</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .bounce-in { animation: bounceIn 0.5s ease-out; }
        @keyframes bounceIn { 0% { transform: scale(0.3); opacity: 0; } 50% { transform: scale(1.05); } 70% { transform: scale(0.9); } 100% { transform: scale(1); opacity: 1; } }
        .product-card:hover { transform: translateY(-2px); transition: all 0.2s ease; }
        .low-stock { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg border-b-4 border-blue-500">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <div class="bg-blue-500 text-white p-2 rounded-lg">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800">Sistema Papel e Arte</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2" id="storeDisplay">
                        <span class="text-sm text-gray-600">Loja:</span>
                        <select id="storeSelector" onchange="changeStore()" class="px-3 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                            <!-- Stores will be loaded here -->
                        </select>
                        <span id="storeName" class="text-sm font-semibold text-blue-600 hidden"></span>
                    </div>
                    <span class="text-sm text-gray-600">Usu√°rio: <span id="currentUser" class="font-semibold">Admin</span></span>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                        Sair
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Login Screen -->
    <div id="loginScreen" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-96 fade-in">
            <div class="text-center mb-6">
                <div class="bg-blue-500 text-white p-3 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z"/>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Login - Papel e Arte</h2>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Usu√°rio</label>
                    <input type="text" id="loginUser" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Senha</label>
                    <input type="password" id="loginPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    Entrar
                </button>
            </form>
            <div class="mt-4 text-sm text-gray-600 text-center">
                <p>Usu√°rios de teste:</p>
                <p><strong>admin</strong> / senha: admin</p>
                <p><strong>funcionario</strong> / senha: 123</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 py-6">
        <!-- Tab Navigation -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="flex border-b">
                <button onclick="showTab('pos')" class="tab-btn px-6 py-3 font-medium text-blue-600 border-b-2 border-blue-600" data-tab="pos">
                    üõí Ponto de Venda
                </button>
                <button onclick="showTab('products')" class="tab-btn px-6 py-3 font-medium text-gray-500 hover:text-gray-700" data-tab="products">
                    üì¶ Produtos
                </button>
                <button onclick="showTab('inventory')" class="tab-btn px-6 py-3 font-medium text-gray-500 hover:text-gray-700" data-tab="inventory">
                    üìä Estoque
                </button>
                <button onclick="showTab('employees')" class="tab-btn px-6 py-3 font-medium text-gray-500 hover:text-gray-700" data-tab="employees">
                    üë• Funcion√°rios
                </button>
                <button onclick="showTab('reports')" class="tab-btn px-6 py-3 font-medium text-gray-500 hover:text-gray-700" data-tab="reports">
                    üìà Relat√≥rios
                </button>
                <button onclick="showTab('calculator')" class="tab-btn px-6 py-3 font-medium text-gray-500 hover:text-gray-700" data-tab="calculator">
                    üìê Calculadora de Material
                </button>
                <button onclick="showTab('quote')" class="tab-btn px-6 py-3 font-medium text-gray-500 hover:text-gray-700" data-tab="quote">
                    üí¨ Or√ßamento
                </button>
                <button onclick="showTab('settings')" class="tab-btn px-6 py-3 font-medium text-gray-500 hover:text-gray-700" data-tab="settings">
                    ‚öôÔ∏è Configura√ß√µes
                </button>

            </div>
        </div>

        <!-- POS Tab -->
        <div id="posTab" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Products Grid -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-gray-800">Produtos</h2>
                            <div class="flex space-x-2">
                                <input type="text" id="productSearch" placeholder="Buscar produto..." class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" onkeyup="searchProducts()">
                                <button onclick="showFeatured()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                                    ‚≠ê Destaques
                                </button>
                                <button onclick="showFavorites()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors">
                                    üìà Mais Vendidos
                                </button>
                                <button onclick="showAllProducts()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                                    üì¶ Todos
                                </button>
                            </div>
                        </div>
                        
                        <!-- Featured Products Section -->
                        <div id="featuredSection" class="mb-6">
                            <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-4 border-2 border-green-200">
                                <h3 class="text-lg font-bold text-green-800 mb-3 flex items-center">
                                    ‚≠ê Produtos em Destaque
                                    <span class="ml-2 text-sm font-normal text-green-600">(Acesso r√°pido)</span>
                                </h3>
                                <div id="featuredProductsGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3">
                                    <!-- Featured products will be loaded here -->
                                </div>
                            </div>
                        </div>
                        <div id="productsGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                            <!-- Products will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Cart Panel -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-md p-6 sticky top-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Carrinho de Vendas</h3>
                        <div id="cartItems" class="space-y-2 mb-4 max-h-64 overflow-y-auto">
                            <p class="text-gray-500 text-center py-8">Carrinho vazio</p>
                        </div>
                        <div class="border-t pt-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">Total:</span>
                                <span id="cartTotal" class="text-xl font-bold text-green-600">R$ 0,00</span>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Forma de Pagamento:</label>
                                <select id="paymentMethod" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2" onchange="handlePaymentMethodChange()">
                                    <option value="dinheiro">üíµ Dinheiro</option>
                                    <option value="pix">üì± PIX</option>
                                    <option value="cartao">üí≥ Cart√£o</option>
                                </select>
                            </div>
                            <div class="mb-4" id="amountReceivedContainer">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Valor Recebido (opcional):</label>
                                <input type="number" id="amountReceived" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Deixe vazio para valor exato" onkeyup="calculateChange()">
                            </div>
                            <div class="flex justify-between items-center mb-4">
                                <span class="font-medium">Troco:</span>
                                <span id="changeAmount" class="text-lg font-bold text-blue-600">R$ 0,00</span>
                            </div>
                            <div class="space-y-2">
                                <button onclick="generateSaleReceipt()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors disabled:bg-gray-400" id="generateReceiptBtn" disabled>
                                    üìÑ Gerar Comprovante PDF
                                </button>
                                <button onclick="finalizeSale()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition-colors disabled:bg-gray-400" id="finalizeSaleBtn" disabled>
                                    Finalizar Venda
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Tab -->
        <div id="productsTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-800">Gerenciar Produtos</h2>
                    <button onclick="showProductForm()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                        ‚ûï Novo Produto
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-2 text-left">Imagem</th>
                                <th class="px-4 py-2 text-left">Nome</th>
                                <th class="px-4 py-2 text-left">Pre√ßo</th>
                                <th class="px-4 py-2 text-left">Estoque</th>
                                <th class="px-4 py-2 text-left">Status</th>
                                <th class="px-4 py-2 text-left">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="productsTable">
                            <!-- Products will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Inventory Tab -->
        <div id="inventoryTab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Movimenta√ß√µes de Estoque</h2>
                    <div class="space-y-2 max-h-96 overflow-y-auto" id="stockMovements">
                        <!-- Stock movements will be loaded here -->
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Alertas de Estoque Baixo</h2>
                    <div id="lowStockAlerts" class="space-y-2">
                        <!-- Low stock alerts will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Employees Tab -->
        <div id="employeesTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-800">Gerenciar Funcion√°rios</h2>
                    <button onclick="showEmployeeForm()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                        ‚ûï Novo Funcion√°rio
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-2 text-left">Nome</th>
                                <th class="px-4 py-2 text-left">Cargo</th>
                                <th class="px-4 py-2 text-left">Loja</th>
                                <th class="px-4 py-2 text-left">Telefone</th>
                                <th class="px-4 py-2 text-left">E-mail</th>
                                <th class="px-4 py-2 text-left">Admiss√£o</th>
                                <th class="px-4 py-2 text-left">Permiss√µes</th>
                                <th class="px-4 py-2 text-left">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="employeesTable">
                            <!-- Employees will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>



        <!-- Quote Tab -->
        <div id="quoteTab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Products Grid -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-gray-800">Produtos para Or√ßamento</h2>
                            <div class="flex space-x-2">
                                <input type="text" id="quoteProductSearch" placeholder="Buscar produto..." class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" onkeyup="searchQuoteProducts()">
                                <button onclick="showQuoteFavorites()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors">
                                    ‚≠ê Favoritos
                                </button>
                            </div>
                        </div>
                        <div id="quoteProductsGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                            <!-- Products will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Quote Panel -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-md p-6 sticky top-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Or√ßamento</h3>
                        <div id="quoteItems" class="space-y-2 mb-4 max-h-64 overflow-y-auto">
                            <p class="text-gray-500 text-center py-8">Or√ßamento vazio</p>
                        </div>
                        <div class="border-t pt-4">
                            <div class="flex justify-between items-center mb-4">
                                <span class="font-medium">Total:</span>
                                <span id="quoteTotal" class="text-xl font-bold text-green-600">R$ 0,00</span>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Cliente:</label>
                                <input type="text" id="customerName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Digite o nome do cliente">
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes (opcional):</label>
                                <textarea id="quoteNotes" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Informa√ß√µes adicionais..."></textarea>
                            </div>
                            <div class="space-y-2">
                                <button onclick="generateQuoteText()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition-colors disabled:bg-gray-400" id="generateQuoteBtn" disabled>
                                    üí¨ Gerar Texto para WhatsApp
                                </button>
                                <button onclick="clearQuote()" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                                    üóëÔ∏è Limpar Or√ßamento
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calculator Tab -->
        <div id="calculatorTab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Material Calculator -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800">Calculadora de Material</h2>
                        <button onclick="showMaterialForm()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                            ‚ûï Novo Material
                        </button>
                    </div>
                    
                    <form onsubmit="calculateMaterial(event)" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Material</label>
                            <select id="selectedMaterial" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required onchange="updateMaterialPrice()">
                                <option value="">Selecione um material...</option>
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Unidade de Medida</label>
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="measurementUnit" value="meters" class="mr-2" checked onchange="toggleMeasurementUnit()">
                                    <span class="text-sm">üìè Metros</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="measurementUnit" value="centimeters" class="mr-2" onchange="toggleMeasurementUnit()">
                                    <span class="text-sm">üìê Cent√≠metros</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1" id="widthLabel">Largura (metros)</label>
                                <input type="number" id="materialWidth" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required onkeyup="calculatePreview()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1" id="heightLabel">Altura (metros)</label>
                                <input type="number" id="materialHeight" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required onkeyup="calculatePreview()">
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">√Årea Total:</span>
                                <span id="totalArea" class="text-lg font-bold text-blue-600">0,00 m¬≤</span>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">Pre√ßo por m¬≤:</span>
                                <span id="pricePerMeter" class="text-lg font-bold text-green-600">R$ 0,00</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="font-medium">Valor Total:</span>
                                <span id="totalPrice" class="text-xl font-bold text-red-600">R$ 0,00</span>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes (opcional)</label>
                            <textarea id="materialNotes" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Detalhes adicionais do or√ßamento..."></textarea>
                        </div>
                        
                        <button type="button" onclick="generateQuotePDF()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                            üìÑ Gerar Or√ßamento PDF
                        </button>
                    </form>
                </div>
                
                <!-- Materials Management -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Materiais Cadastrados</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-2 text-left">Material</th>
                                    <th class="px-4 py-2 text-left">Pre√ßo/m¬≤</th>
                                    <th class="px-4 py-2 text-left">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="materialsTable">
                                <!-- Materials will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsTab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- System Settings -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">‚öôÔ∏è Configura√ß√µes do Sistema</h2>
                    
                    <!-- Company Info -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">üè¢ Informa√ß√µes da Empresa</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nome da Empresa</label>
                                <input type="text" id="companyName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" value="Sistema Papel e Arte">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Slogan/Descri√ß√£o</label>
                                <input type="text" id="companySlogan" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ex: Comunica√ß√£o Visual">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Telefone Principal</label>
                                <input type="tel" id="companyPhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="(11) 99999-9999">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                                <input type="email" id="companyEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="contato@empresa.com">
                            </div>
                        </div>
                    </div>

                    <!-- Logo Upload -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">üé® Logo da Empresa</h3>
                        <div class="space-y-4">
                            <div class="flex items-center space-x-4">
                                <div id="logoPreview" class="w-16 h-16 bg-blue-500 text-white rounded-lg flex items-center justify-center">
                                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <input type="file" id="logoUpload" accept="image/*" class="hidden" onchange="handleLogoUpload(event)">
                                    <button onclick="document.getElementById('logoUpload').click()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                                        üìÅ Escolher Logo
                                    </button>
                                    <button onclick="resetLogo()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors ml-2">
                                        üîÑ Resetar
                                    </button>
                                    <button onclick="removeLogo()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors ml-2">
                                        üóëÔ∏è Remover
                                    </button>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500">Recomendado: PNG ou JPG, m√°ximo 2MB, propor√ß√£o quadrada</p>
                        </div>
                    </div>

                    <button onclick="saveSystemSettings()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                        üíæ Salvar Configura√ß√µes
                    </button>
                </div>

                <!-- Store Management -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800">üè™ Gerenciar Lojas</h2>
                        <button onclick="showStoreForm()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                            ‚ûï Nova Loja
                        </button>
                    </div>
                    
                    <div class="space-y-4" id="storesList">
                        <!-- Stores will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Advanced Settings -->
            <div class="bg-white rounded-lg shadow-md p-6 mt-6">
                <h2 class="text-xl font-bold text-gray-800 mb-6">üîß Configura√ß√µes Avan√ßadas</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Receipt Settings -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">üßæ Configura√ß√µes de Comprovante</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Mensagem do Rodap√©</label>
                                <textarea id="receiptFooter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2" placeholder="Obrigado pela prefer√™ncia!"></textarea>
                            </div>
                            <div>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" id="showLogoOnReceipt" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                    <span class="text-sm font-medium text-gray-700">Mostrar logo no comprovante</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- System Preferences -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">üéõÔ∏è Prefer√™ncias do Sistema</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Moeda Padr√£o</label>
                                <select id="defaultCurrency" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="BRL">Real Brasileiro (R$)</option>
                                    <option value="USD">D√≥lar Americano ($)</option>
                                    <option value="EUR">Euro (‚Ç¨)</option>
                                </select>
                            </div>
                            <div>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" id="autoBackup" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                    <span class="text-sm font-medium text-gray-700">Backup autom√°tico dos dados</span>
                                </label>
                            </div>
                            <div>
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" id="soundNotifications" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                    <span class="text-sm font-medium text-gray-700">Notifica√ß√µes sonoras</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Backup Management -->
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">üíæ Backup e Restaura√ß√£o</h3>
                    
                    <!-- Backup Options -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <!-- Products Backup -->
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <h4 class="font-semibold text-blue-800 mb-3">üì¶ Backup de Produtos</h4>
                            <p class="text-sm text-blue-600 mb-3">Salve todos os produtos, estoque e configura√ß√µes</p>
                            <div class="space-y-2">
                                <button onclick="exportProducts()" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                                    üì§ Exportar Produtos
                                </button>
                                <button onclick="importProducts()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                    üì• Importar Produtos
                                </button>
                            </div>
                        </div>

                        <!-- Reports Backup -->
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <h4 class="font-semibold text-green-800 mb-3">üìà Backup de Relat√≥rios</h4>
                            <p class="text-sm text-green-600 mb-3">Salve hist√≥rico de vendas e movimenta√ß√µes</p>
                            <div class="space-y-2">
                                <button onclick="exportReports()" class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                                    üì§ Exportar Relat√≥rios
                                </button>
                                <button onclick="importReports()" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                                    üì• Importar Relat√≥rios
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Complete System Backup -->
                    <div class="bg-purple-50 p-4 rounded-lg border border-purple-200 mb-4">
                        <h4 class="font-semibold text-purple-800 mb-3">üîÑ Backup Completo do Sistema</h4>
                        <p class="text-sm text-purple-600 mb-3">Inclui produtos, relat√≥rios, funcion√°rios, lojas e configura√ß√µes</p>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="exportAllData()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                                üì§ Backup Completo
                            </button>
                            <button onclick="importData()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                                üì• Restaurar Sistema
                            </button>
                            <button onclick="resetAllData()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                                üóëÔ∏è Resetar Sistema
                            </button>
                        </div>
                    </div>

                    <!-- Backup Schedule -->
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                        <h4 class="font-semibold text-yellow-800 mb-3">‚è∞ Backup Autom√°tico</h4>
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-yellow-700">Gerar backup autom√°tico dos dados importantes</p>
                                <p class="text-xs text-yellow-600">√öltimo backup: <span id="lastBackupDate">Nunca</span></p>
                            </div>
                            <button onclick="scheduleAutoBackup()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors">
                                üîÑ Backup Agora
                            </button>
                        </div>
                    </div>

                    <!-- Hidden file inputs -->
                    <input type="file" id="importFile" accept=".json" class="hidden" onchange="handleDataImport(event)">
                    <input type="file" id="importProductsFile" accept=".json" class="hidden" onchange="handleProductsImport(event)">
                    <input type="file" id="importReportsFile" accept=".json" class="hidden" onchange="handleReportsImport(event)">
                </div>

                <button onclick="saveAdvancedSettings()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition-colors mt-6">
                    üíæ Salvar Configura√ß√µes Avan√ßadas
                </button>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reportsTab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Relat√≥rios de Vendas</h2>
                    <div class="space-y-4">
                        <div class="flex space-x-2">
                            <button onclick="generateReport('daily')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                                Vendas Hoje
                            </button>
                            <button onclick="generateReport('weekly')" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                                Esta Semana
                            </button>
                            <button onclick="generateReport('monthly')" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                                Este M√™s
                            </button>
                        </div>
                        <button onclick="exportToPDF()" class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                            üìÑ Exportar PDF
                        </button>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Resumo de Vendas</h3>
                    <div id="salesSummary" class="space-y-2">
                        <!-- Sales summary will be loaded here -->
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 mt-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">Hist√≥rico de Vendas</h3>
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-2 text-left">Data/Hora</th>
                                <th class="px-4 py-2 text-left">Itens</th>
                                <th class="px-4 py-2 text-left">Total</th>
                                <th class="px-4 py-2 text-left">Pagamento</th>
                                <th class="px-4 py-2 text-left">Funcion√°rio</th>
                            </tr>
                        </thead>
                        <tbody id="salesHistory">
                            <!-- Sales history will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Form Modal -->
    <div id="productModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-96 max-w-90vw fade-in">
            <h3 class="text-lg font-bold text-gray-800 mb-4" id="productModalTitle">Novo Produto</h3>
            <form onsubmit="saveProduct(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
                        <input type="text" id="productName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                        <textarea id="productDescription" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Pre√ßo (R$)</label>
                        <input type="number" id="productPrice" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Quantidade em Estoque</label>
                        <input type="number" id="productStock" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Estoque M√≠nimo</label>
                        <input type="number" id="productMinStock" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" value="5">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Emoji do Produto</label>
                        <input type="text" id="productEmoji" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="üçï" maxlength="2">
                    </div>
                    <div>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="allowSellWithoutStock" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700">Permitir venda sem estoque</span>
                        </label>
                        <p class="text-xs text-gray-500 mt-1">Quando marcado, permite vender este produto mesmo com estoque zerado</p>
                    </div>
                    <div>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="isFeaturedProduct" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                            <span class="text-sm font-medium text-gray-700">‚≠ê Produto em Destaque</span>
                        </label>
                        <p class="text-xs text-gray-500 mt-1">Produtos em destaque aparecem na tela inicial do PDV</p>
                    </div>
                </div>
                <div class="flex space-x-2 mt-6">
                    <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        Salvar
                    </button>
                    <button type="button" onclick="hideProductForm()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Material Form Modal -->
    <div id="materialModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-96 max-w-90vw fade-in">
            <h3 class="text-lg font-bold text-gray-800 mb-4" id="materialModalTitle">Novo Material</h3>
            <form onsubmit="saveMaterial(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Material</label>
                        <input type="text" id="materialNameInput" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Pre√ßo por m¬≤ (R$)</label>
                        <input type="number" id="materialPriceInput" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o (opcional)</label>
                        <textarea id="materialDescriptionInput" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2" placeholder="Caracter√≠sticas do material..."></textarea>
                    </div>
                </div>
                <div class="flex space-x-2 mt-6">
                    <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        Salvar
                    </button>
                    <button type="button" onclick="hideMaterialForm()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Quote Text Modal -->
    <div id="quoteTextModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-96 max-w-90vw fade-in">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Texto do Or√ßamento</h3>
            <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
                    <label class="block text-sm font-medium text-gray-700">Edite o texto conforme necess√°rio:</label>
                    <button onclick="toggleEditMode()" id="editToggleBtn" class="text-sm bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded transition-colors">
                        ‚úèÔ∏è Editar
                    </button>
                </div>
                <textarea id="quoteTextContent" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="12" readonly></textarea>
                <p class="text-xs text-gray-500 mt-1">üí° Dica: Clique em "Editar" para personalizar o texto antes de copiar</p>
            </div>
            <div class="flex space-x-2">
                <button onclick="copyQuoteText()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    üìã Copiar Texto
                </button>
                <button onclick="regenerateQuoteText()" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    üîÑ Regenerar
                </button>
                <button onclick="hideQuoteTextModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Store Form Modal -->
    <div id="storeModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-96 max-w-90vw fade-in">
            <h3 class="text-lg font-bold text-gray-800 mb-4" id="storeModalTitle">Nova Loja</h3>
            <form onsubmit="saveStore(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nome da Loja</label>
                        <input type="text" id="storeName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Endere√ßo</label>
                        <textarea id="storeAddress" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" required></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                        <input type="tel" id="storePhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                        <input type="email" id="storeEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Gerente Respons√°vel</label>
                        <input type="text" id="storeManager" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                <div class="flex space-x-2 mt-6">
                    <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        Salvar
                    </button>
                    <button type="button" onclick="hideStoreForm()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Employee Form Modal -->
    <div id="employeeModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-96 max-w-90vw fade-in">
            <h3 class="text-lg font-bold text-gray-800 mb-4" id="employeeModalTitle">Novo Funcion√°rio</h3>
            <form onsubmit="saveEmployee(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
                        <input type="text" id="employeeName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Cargo</label>
                        <select id="employeeRole" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Selecione...</option>
                            <option value="Administrador">Administrador</option>
                            <option value="Funcion√°rio">Funcion√°rio</option>
                            <option value="Gerente">Gerente</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                        <input type="tel" id="employeePhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                        <input type="email" id="employeeEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Data de Admiss√£o</label>
                        <input type="date" id="employeeHireDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Loja</label>
                        <select id="employeeStore" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Selecione a loja...</option>
                            <!-- Stores will be loaded here -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Usu√°rio (Login)</label>
                        <input type="text" id="employeeUsername" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Senha</label>
                        <input type="password" id="employeePassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Permiss√µes de Acesso:</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="permissionPOS" class="mr-2" checked>
                                <span class="text-sm">üõí Ponto de Venda</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="permissionProducts" class="mr-2">
                                <span class="text-sm">üì¶ Gerenciar Produtos</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="permissionInventory" class="mr-2">
                                <span class="text-sm">üìä Visualizar Estoque</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="permissionReports" class="mr-2">
                                <span class="text-sm">üìà Acessar Relat√≥rios</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="permissionCalculator" class="mr-2">
                                <span class="text-sm">üìê Calculadora de Material</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="permissionQuote" class="mr-2">
                                <span class="text-sm">üí¨ Or√ßamento</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="flex space-x-2 mt-6">
                    <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        Salvar
                    </button>
                    <button type="button" onclick="hideEmployeeForm()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let userRole = null;
        let currentStore = null;
        let stores = [];
        let products = [];
        let employees = [];
        let cart = [];
        let sales = [];
        let stockMovements = [];
        let materials = [];
        let quote = [];
        let editingProductId = null;
        let editingEmployeeId = null;
        let editingMaterialId = null;
        let editingStoreId = null;
        let systemSettings = {};
        let companyLogo = null;


        // Initialize the system
        function initSystem() {
            loadSystemSettings();
            loadStores();
            loadSampleData();
            loadProducts();
            loadQuoteProducts();
            loadEmployees();
            loadMaterials();
            loadSalesHistory();
            loadStockMovements();
            updateLowStockAlerts();
            updateSalesSummary();
            loadStoresList();
        }
        


        // Store management
        function loadStores() {
            if (!localStorage.getItem('pdv_stores')) {
                stores = [
                    { id: 1, name: 'Loja Porto do Carro', address: 'Rua Porto do Carro, 123 - Centro' },
                    { id: 2, name: 'Loja Manoel Correa', address: 'Rua Manoel Correa, 456 - Bairro Novo' }
                ];
                localStorage.setItem('pdv_stores', JSON.stringify(stores));
            } else {
                stores = JSON.parse(localStorage.getItem('pdv_stores'));
            }
            
            // Load store selector
            const storeSelector = document.getElementById('storeSelector');
            const employeeStoreSelect = document.getElementById('employeeStore');
            
            if (storeSelector) {
                storeSelector.innerHTML = '';
                stores.forEach(store => {
                    const option = document.createElement('option');
                    option.value = store.id;
                    option.textContent = store.name;
                    storeSelector.appendChild(option);
                });
                
                // Set default store if not set
                if (!currentStore && stores.length > 0) {
                    currentStore = stores[0].id;
                    storeSelector.value = currentStore;
                }
            }
            
            if (employeeStoreSelect) {
                employeeStoreSelect.innerHTML = '<option value="">Selecione a loja...</option>';
                stores.forEach(store => {
                    const option = document.createElement('option');
                    option.value = store.id;
                    option.textContent = store.name;
                    employeeStoreSelect.appendChild(option);
                });
            }
        }
        
        function changeStore() {
            // Only allow admin to change stores
            if (userRole !== 'Administrador') {
                showNotification('Apenas administradores podem trocar de loja!', 'error');
                return;
            }
            
            const newStoreId = parseInt(document.getElementById('storeSelector').value);
            if (newStoreId !== currentStore) {
                currentStore = newStoreId;
                
                // Clear cart when changing stores
                cart = [];
                updateCartDisplay();
                
                // Reload all data for the new store
                loadProducts();
                loadQuoteProducts();
                loadEmployees();
                loadMaterials();
                loadSalesHistory();
                loadStockMovements();
                updateLowStockAlerts();
                updateSalesSummary();
                
                const storeName = stores.find(s => s.id === currentStore)?.name || 'Loja';
                showNotification(`Mudou para: ${storeName}`, 'info');
            }
        }

        // Load sample data
        function loadSampleData() {
            if (!localStorage.getItem('pdv_products')) {
                products = [
                    { id: 1, name: 'Impress√£o P&B A4', description: 'Impress√£o preto e branco em papel A4 sulfite 75g', price: 0.15, stock: 5000, minStock: 1000, emoji: 'üñ®Ô∏è', sales: 245, allowSellWithoutStock: true, isFeatured: true },
                    { id: 2, name: 'Impress√£o Colorida A4', description: 'Impress√£o colorida em papel A4 sulfite 75g', price: 0.50, stock: 2000, minStock: 500, emoji: 'üåà', sales: 132, allowSellWithoutStock: true, isFeatured: true },
                    { id: 3, name: 'C√≥pia Simples A4', description: 'C√≥pia xerogr√°fica preto e branco A4', price: 0.10, stock: 8000, minStock: 2000, emoji: 'üìÑ', sales: 378, allowSellWithoutStock: true, isFeatured: true },
                    { id: 4, name: 'Digitaliza√ß√£o/Scanner', description: 'Digitaliza√ß√£o de documentos at√© A4 - 300dpi', price: 2.00, stock: 100, minStock: 20, emoji: 'üì±', sales: 56, allowSellWithoutStock: true, isFeatured: false },
                    { id: 5, name: 'Plastifica√ß√£o A4', description: 'Plastifica√ß√£o com filme pl√°stico A4', price: 3.50, stock: 150, minStock: 30, emoji: 'üõ°Ô∏è', sales: 89, allowSellWithoutStock: false, isFeatured: true },
                    { id: 6, name: 'Encaderna√ß√£o Espiral', description: 'Encaderna√ß√£o com espiral pl√°stico at√© 100 folhas', price: 8.00, stock: 80, minStock: 15, emoji: 'üìö', sales: 67, allowSellWithoutStock: false, isFeatured: false },
                    { id: 7, name: 'Impress√£o Foto 10x15', description: 'Impress√£o fotogr√°fica 10x15cm papel fotogr√°fico', price: 1.50, stock: 200, minStock: 50, emoji: 'üì∏', sales: 123, allowSellWithoutStock: false, isFeatured: true },
                    { id: 8, name: 'Cart√£o de Visita', description: 'Cart√£o de visita 4x0 cores - 100 unidades', price: 25.00, stock: 50, minStock: 10, emoji: 'üíº', sales: 34, allowSellWithoutStock: false, isFeatured: true },
                    { id: 9, name: 'Banner 1m¬≤', description: 'Banner em lona 440g por metro quadrado', price: 15.00, stock: 25, minStock: 5, emoji: 'üè∑Ô∏è', sales: 28, allowSellWithoutStock: false, isFeatured: false },
                    { id: 10, name: 'Adesivo A4', description: 'Adesivo vinil branco A4 para impress√£o', price: 4.00, stock: 120, minStock: 25, emoji: 'üè∑Ô∏è', sales: 45, allowSellWithoutStock: false, isFeatured: false }
                ];
                localStorage.setItem('pdv_products', JSON.stringify(products));
            } else {
                products = JSON.parse(localStorage.getItem('pdv_products'));
            }

            if (!localStorage.getItem('pdv_employees')) {
                employees = [
                    { 
                        id: 1, 
                        name: 'Administrador', 
                        role: 'Administrador', 
                        storeId: 1,
                        phone: '(11) 99999-9999', 
                        email: 'admin@pdv.com', 
                        hireDate: '2024-01-01', 
                        username: 'admin', 
                        password: 'admin',
                        permissions: { pos: true, products: true, inventory: true, reports: true, calculator: true, quote: true }
                    },
                    { 
                        id: 2, 
                        name: 'Jo√£o Silva', 
                        role: 'Funcion√°rio', 
                        storeId: 1,
                        phone: '(11) 98888-8888', 
                        email: 'joao@pdv.com', 
                        hireDate: '2024-02-15', 
                        username: 'funcionario', 
                        password: '123',
                        permissions: { pos: true, products: false, inventory: false, reports: false, calculator: false, quote: true }
                    },
                    { 
                        id: 3, 
                        name: 'Maria Santos', 
                        role: 'Funcion√°rio', 
                        storeId: 2,
                        phone: '(11) 97777-7777', 
                        email: 'maria@pdv.com', 
                        hireDate: '2024-03-01', 
                        username: 'maria', 
                        password: '123',
                        permissions: { pos: true, products: false, inventory: false, reports: false, calculator: false, quote: true }
                    }
                ];
                localStorage.setItem('pdv_employees', JSON.stringify(employees));
            } else {
                employees = JSON.parse(localStorage.getItem('pdv_employees'));
            }

            if (!localStorage.getItem('pdv_sales')) {
                sales = [];
                localStorage.setItem('pdv_sales', JSON.stringify(sales));
            } else {
                sales = JSON.parse(localStorage.getItem('pdv_sales'));
            }

            if (!localStorage.getItem('pdv_stock_movements')) {
                stockMovements = [];
                localStorage.setItem('pdv_stock_movements', JSON.stringify(stockMovements));
            } else {
                stockMovements = JSON.parse(localStorage.getItem('pdv_stock_movements'));
            }

            if (!localStorage.getItem('pdv_materials')) {
                materials = [
                    { id: 1, name: 'Lona Vin√≠lica', price: 15.50, description: 'Lona vin√≠lica para impress√£o digital, resistente √† √°gua' },
                    { id: 2, name: 'Adesivo Vinil', price: 12.80, description: 'Adesivo vinil branco para aplica√ß√£o externa' },
                    { id: 3, name: 'Banner 440g', price: 8.90, description: 'Banner lona 440g para impress√£o digital' },
                    { id: 4, name: 'Papel Fotogr√°fico', price: 25.00, description: 'Papel fotogr√°fico premium para impress√£o de alta qualidade' },
                    { id: 5, name: 'Acr√≠lico 3mm', price: 45.00, description: 'Placa de acr√≠lico cristal 3mm de espessura' },
                    { id: 6, name: 'Forex 5mm', price: 18.50, description: 'Placa de PVC expandido (Forex) 5mm' }
                ];
                localStorage.setItem('pdv_materials', JSON.stringify(materials));
            } else {
                materials = JSON.parse(localStorage.getItem('pdv_materials'));
            }
        }

        // Login system
        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('loginUser').value;
            const password = document.getElementById('loginPassword').value;

            const user = employees.find(emp => emp.username === username && emp.password === password);
            
            if (user) {
                currentUser = user.name;
                userRole = user.role;
                currentStore = user.storeId || 1;
                window.currentUserPermissions = user.permissions || { pos: true, products: false, inventory: false, reports: false, calculator: false, quote: false };
                
                document.getElementById('currentUser').textContent = currentUser;
                
                // Show/hide store selector based on role
                const storeSelector = document.getElementById('storeSelector');
                const storeName = document.getElementById('storeName');
                
                if (userRole === 'Administrador') {
                    // Admin can choose store
                    storeSelector.classList.remove('hidden');
                    storeName.classList.add('hidden');
                    storeSelector.value = currentStore;
                } else {
                    // Other users see only their store name
                    storeSelector.classList.add('hidden');
                    storeName.classList.remove('hidden');
                    const store = stores.find(s => s.id === currentStore);
                    storeName.textContent = store ? store.name : 'Loja';
                }
                
                document.getElementById('loginScreen').classList.add('hidden');
                
                // Load data for user's store
                loadProducts();
                loadQuoteProducts();
                loadEmployees();
                loadMaterials();
                loadSalesHistory();
                loadStockMovements();
                updateLowStockAlerts();
                updateSalesSummary();
                
                // Apply permissions to tabs
                applyUserPermissions();
                
                const storeNameText = stores.find(s => s.id === currentStore)?.name || 'Loja';
                showNotification(`Login realizado com sucesso! Loja: ${storeNameText}`, 'success');
            } else {
                showNotification('Usu√°rio ou senha incorretos!', 'error');
            }
        }

        function applyUserPermissions() {
            const permissions = window.currentUserPermissions;
            
            // Hide/show tabs based on permissions
            document.querySelector('[data-tab="pos"]').style.display = permissions.pos ? 'block' : 'none';
            document.querySelector('[data-tab="products"]').style.display = permissions.products ? 'block' : 'none';
            document.querySelector('[data-tab="inventory"]').style.display = permissions.inventory ? 'block' : 'none';
            document.querySelector('[data-tab="reports"]').style.display = permissions.reports ? 'block' : 'none';
            document.querySelector('[data-tab="calculator"]').style.display = permissions.calculator ? 'block' : 'none';
            document.querySelector('[data-tab="quote"]').style.display = permissions.quote ? 'block' : 'none';
            
            // Show employees and settings tabs only for administrators
            document.querySelector('[data-tab="employees"]').style.display = userRole === 'Administrador' ? 'block' : 'none';
            document.querySelector('[data-tab="settings"]').style.display = userRole === 'Administrador' ? 'block' : 'none';
            
            // Show first available tab
            const availableTabs = ['pos', 'products', 'inventory', 'employees', 'reports', 'calculator', 'quote', 'settings'].filter(tab => {
                if (tab === 'employees' || tab === 'settings') return userRole === 'Administrador';
                return permissions[tab];
            });
            
            if (availableTabs.length > 0) {
                showTab(availableTabs[0]);
            }
        }

        function logout() {
            currentUser = null;
            userRole = null;
            window.currentUserPermissions = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            
            // Reset store selector visibility
            document.getElementById('storeSelector').classList.remove('hidden');
            document.getElementById('storeName').classList.add('hidden');
            
            // Reset all tabs to visible
            document.querySelector('[data-tab="pos"]').style.display = 'block';
            document.querySelector('[data-tab="products"]').style.display = 'block';
            document.querySelector('[data-tab="inventory"]').style.display = 'block';
            document.querySelector('[data-tab="employees"]').style.display = 'block';
            document.querySelector('[data-tab="reports"]').style.display = 'block';
            document.querySelector('[data-tab="calculator"]').style.display = 'block';
            document.querySelector('[data-tab="quote"]').style.display = 'block';
            document.querySelector('[data-tab="settings"]').style.display = 'block';
            
            cart = [];
            updateCartDisplay();
        }

        // Tab navigation
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
                btn.classList.add('text-gray-500', 'hover:text-gray-700');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            // Add active class to selected tab button
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            activeBtn.classList.remove('text-gray-500', 'hover:text-gray-700');
            activeBtn.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
        }

        // Product management
        function loadProducts() {
            const grid = document.getElementById('productsGrid');
            const featuredGrid = document.getElementById('featuredProductsGrid');
            const table = document.getElementById('productsTable');
            
            if (!grid || !table) return;
            
            grid.innerHTML = '';
            table.innerHTML = '';
            if (featuredGrid) featuredGrid.innerHTML = '';
            
            // Filter products by current store
            const storeProducts = products.filter(product => 
                !product.storeId || product.storeId === currentStore
            );
            
            // Load featured products first
            const featuredProducts = storeProducts.filter(product => product.isFeatured);
            
            if (featuredGrid && featuredProducts.length > 0) {
                featuredProducts.forEach(product => {
                    const card = createProductCard(product, 'featured');
                    featuredGrid.appendChild(card);
                });
            } else if (featuredGrid) {
                featuredGrid.innerHTML = '<p class="text-gray-500 text-center py-4 col-span-full">Nenhum produto em destaque configurado</p>';
            }
            
            storeProducts.forEach(product => {
                // Product card for POS
                const card = createProductCard(product, 'normal');
                grid.appendChild(card);
                
                // Product row for management table
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                
                const stockClass = product.stock <= product.minStock ? 'text-red-500 low-stock' : 'text-green-600';
                
                row.innerHTML = `
                    <td class="px-4 py-2">
                        <div class="text-2xl">${product.emoji}</div>
                        ${product.isFeatured ? '<div class="text-xs text-green-600">‚≠ê Destaque</div>' : ''}
                    </td>
                    <td class="px-4 py-2">
                        <div class="font-medium">${product.name}</div>
                        <div class="text-sm text-gray-500">${product.description}</div>
                    </td>
                    <td class="px-4 py-2">R$ ${product.price.toFixed(2)}</td>
                    <td class="px-4 py-2">
                        <span class="${stockClass}">${product.stock}</span>
                    </td>
                    <td class="px-4 py-2">
                        <span class="px-2 py-1 rounded-full text-xs ${product.stock > product.minStock ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${product.stock > product.minStock ? 'Normal' : 'Baixo'}
                        </span>
                    </td>
                    <td class="px-4 py-2">
                        <button onclick="editProduct(${product.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-sm mr-1">
                            Editar
                        </button>
                        <button onclick="duplicateProduct(${product.id})" class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-sm mr-1">
                            Duplicar
                        </button>
                        <button onclick="deleteProduct(${product.id})" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-sm">
                            Deletar
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function createProductCard(product, type = 'normal') {
            const card = document.createElement('div');
            const stockClass = product.stock <= product.minStock ? 'text-red-500 low-stock' : 'text-green-600';
            
            if (type === 'featured') {
                card.className = 'product-card bg-gradient-to-br from-green-50 to-blue-50 border-2 border-green-300 rounded-lg p-3 cursor-pointer hover:border-green-500 transition-all shadow-md';
                card.innerHTML = `
                    <div class="text-center">
                        <div class="text-3xl mb-1">${product.emoji}</div>
                        <h3 class="font-semibold text-gray-800 mb-1 text-sm">${product.name}</h3>
                        <p class="text-lg font-bold text-green-600">R$ ${product.price.toFixed(2)}</p>
                        <p class="text-xs ${stockClass}">Est: ${product.stock}</p>
                        <div class="text-xs text-green-600 mt-1">‚≠ê Destaque</div>
                    </div>
                `;
            } else {
                card.className = 'product-card bg-white border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-blue-500 transition-all';
                card.innerHTML = `
                    <div class="text-center">
                        <div class="text-4xl mb-2">${product.emoji}</div>
                        <h3 class="font-semibold text-gray-800 mb-1">${product.name}</h3>
                        <p class="text-lg font-bold text-blue-600">R$ ${product.price.toFixed(2)}</p>
                        <p class="text-sm ${stockClass}">Estoque: ${product.stock}</p>
                        ${product.isFeatured ? '<div class="text-xs text-green-600 mt-1">‚≠ê Destaque</div>' : ''}
                    </div>
                `;
            }
            
            card.onclick = () => addToCart(product);
            return card;
        }

        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const cards = document.querySelectorAll('.product-card');
            
            cards.forEach(card => {
                const productName = card.querySelector('h3').textContent.toLowerCase();
                if (productName.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function showFeatured() {
            const cards = document.querySelectorAll('#productsGrid .product-card');
            const featuredSection = document.getElementById('featuredSection');
            
            // Hide featured section and show only featured products in main grid
            if (featuredSection) featuredSection.style.display = 'none';
            
            cards.forEach(card => {
                const productName = card.querySelector('h3').textContent;
                const product = products.find(p => p.name === productName);
                card.style.display = (product && product.isFeatured) ? 'block' : 'none';
            });
        }

        function showFavorites() {
            const cards = document.querySelectorAll('#productsGrid .product-card');
            const featuredSection = document.getElementById('featuredSection');
            const favoriteProducts = products.sort((a, b) => (b.sales || 0) - (a.sales || 0)).slice(0, 8);
            
            // Hide featured section
            if (featuredSection) featuredSection.style.display = 'none';
            
            cards.forEach(card => {
                const productName = card.querySelector('h3').textContent;
                const isFavorite = favoriteProducts.some(fav => fav.name === productName);
                card.style.display = isFavorite ? 'block' : 'none';
            });
        }

        function showAllProducts() {
            const cards = document.querySelectorAll('#productsGrid .product-card');
            const featuredSection = document.getElementById('featuredSection');
            
            // Show featured section and all products
            if (featuredSection) featuredSection.style.display = 'block';
            
            cards.forEach(card => {
                card.style.display = 'block';
            });
        }

        function showProductForm() {
            editingProductId = null;
            document.getElementById('productModalTitle').textContent = 'Novo Produto';
            document.getElementById('productName').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productStock').value = '';
            document.getElementById('productMinStock').value = '5';
            document.getElementById('productEmoji').value = '';
            document.getElementById('allowSellWithoutStock').checked = false;
            document.getElementById('isFeaturedProduct').checked = false;
            document.getElementById('productModal').classList.remove('hidden');
        }

        function hideProductForm() {
            document.getElementById('productModal').classList.add('hidden');
        }

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (product) {
                editingProductId = id;
                document.getElementById('productModalTitle').textContent = 'Editar Produto';
                document.getElementById('productName').value = product.name;
                document.getElementById('productDescription').value = product.description;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productMinStock').value = product.minStock;
                document.getElementById('productEmoji').value = product.emoji;
                document.getElementById('allowSellWithoutStock').checked = product.allowSellWithoutStock || false;
                document.getElementById('isFeaturedProduct').checked = product.isFeatured || false;
                document.getElementById('productModal').classList.remove('hidden');
            }
        }

        function saveProduct(event) {
            event.preventDefault();
            
            const productData = {
                name: document.getElementById('productName').value,
                description: document.getElementById('productDescription').value,
                price: parseFloat(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                minStock: parseInt(document.getElementById('productMinStock').value),
                emoji: document.getElementById('productEmoji').value || 'üì¶',
                allowSellWithoutStock: document.getElementById('allowSellWithoutStock').checked,
                isFeatured: document.getElementById('isFeaturedProduct').checked,
                storeId: currentStore
            };
            
            if (editingProductId) {
                const index = products.findIndex(p => p.id === editingProductId);
                // Preserve existing sales data when editing
                products[index] = { ...products[index], ...productData };
                showNotification('Produto atualizado com sucesso!', 'success');
            } else {
                const newId = Math.max(...products.map(p => p.id), 0) + 1;
                products.push({ id: newId, ...productData, sales: 0 });
                showNotification('Produto cadastrado com sucesso!', 'success');
            }
            
            localStorage.setItem('pdv_products', JSON.stringify(products));
            loadProducts();
            hideProductForm();
            updateLowStockAlerts();
        }

        function duplicateProduct(id) {
            const product = products.find(p => p.id === id);
            if (product) {
                const newId = Math.max(...products.map(p => p.id), 0) + 1;
                const duplicatedProduct = {
                    ...product,
                    id: newId,
                    name: product.name + ' (C√≥pia)',
                    sales: 0 // Reset sales for duplicated product
                };
                
                products.push(duplicatedProduct);
                localStorage.setItem('pdv_products', JSON.stringify(products));
                loadProducts();
                updateLowStockAlerts();
                showNotification('Produto duplicado com sucesso!', 'success');
            }
        }

        function deleteProduct(id) {
            if (confirm('Tem certeza que deseja deletar este produto?')) {
                products = products.filter(p => p.id !== id);
                localStorage.setItem('pdv_products', JSON.stringify(products));
                loadProducts();
                updateLowStockAlerts();
                showNotification('Produto deletado com sucesso!', 'success');
            }
        }

        // Cart management
        function addToCart(product) {
            if (product.stock <= 0 && !product.allowSellWithoutStock) {
                showNotification('Produto sem estoque!', 'error');
                return;
            }
            
            const existingItem = cart.find(item => item.id === product.id);
            
            if (existingItem) {
                if (product.allowSellWithoutStock || existingItem.quantity < product.stock) {
                    existingItem.quantity++;
                } else {
                    showNotification('Quantidade m√°xima em estoque atingida!', 'warning');
                    return;
                }
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1,
                    emoji: product.emoji,
                    allowSellWithoutStock: product.allowSellWithoutStock
                });
            }
            
            updateCartDisplay();
            showNotification(`${product.name} adicionado ao carrinho!`, 'success');
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartDisplay();
        }

        function updateCartQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            const product = products.find(p => p.id === productId);
            
            if (item) {
                const newQuantity = item.quantity + change;
                if (newQuantity <= 0) {
                    removeFromCart(productId);
                } else if (product.allowSellWithoutStock || newQuantity <= product.stock) {
                    item.quantity = newQuantity;
                    updateCartDisplay();
                } else {
                    showNotification('Quantidade m√°xima em estoque atingida!', 'warning');
                }
            }
        }

        function updateCartDisplay() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            const finalizeSaleBtn = document.getElementById('finalizeSaleBtn');
            const generateReceiptBtn = document.getElementById('generateReceiptBtn');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="text-gray-500 text-center py-8">Carrinho vazio</p>';
                cartTotal.textContent = 'R$ 0,00';
                finalizeSaleBtn.disabled = true;
                generateReceiptBtn.disabled = true;
                return;
            }
            
            let total = 0;
            cartItems.innerHTML = '';
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex items-center justify-between bg-gray-50 p-2 rounded';
                itemDiv.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <span class="text-lg">${item.emoji}</span>
                        <div>
                            <div class="font-medium text-sm">${item.name}</div>
                            <div class="text-xs text-gray-500">R$ ${item.price.toFixed(2)} cada</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-1">
                        <button onclick="updateCartQuantity(${item.id}, -1)" class="bg-red-500 hover:bg-red-600 text-white w-6 h-6 rounded text-xs">-</button>
                        <span class="mx-2 font-medium">${item.quantity}</span>
                        <button onclick="updateCartQuantity(${item.id}, 1)" class="bg-green-500 hover:bg-green-600 text-white w-6 h-6 rounded text-xs">+</button>
                        <button onclick="removeFromCart(${item.id})" class="bg-gray-500 hover:bg-gray-600 text-white w-6 h-6 rounded text-xs ml-2">√ó</button>
                    </div>
                `;
                cartItems.appendChild(itemDiv);
            });
            
            cartTotal.textContent = `R$ ${total.toFixed(2)}`;
            finalizeSaleBtn.disabled = false;
            generateReceiptBtn.disabled = false;
            calculateChange();
        }

        function handlePaymentMethodChange() {
            const paymentMethod = document.getElementById('paymentMethod').value;
            const amountReceivedContainer = document.getElementById('amountReceivedContainer');
            const amountReceived = document.getElementById('amountReceived');
            const changeAmountContainer = document.getElementById('changeAmount').parentElement;
            
            if (paymentMethod === 'dinheiro') {
                amountReceivedContainer.style.display = 'block';
                changeAmountContainer.style.display = 'flex';
                amountReceived.required = false;
                amountReceived.value = ''; // Clear the field for cash payments
            } else {
                amountReceivedContainer.style.display = 'none';
                changeAmountContainer.style.display = 'none';
                amountReceived.required = false;
                // For PIX and card, set received amount equal to total
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                amountReceived.value = total.toFixed(2);
            }
            calculateChange();
        }

        function calculateChange() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const received = parseFloat(document.getElementById('amountReceived').value) || 0;
            const change = received - total;
            
            document.getElementById('changeAmount').textContent = `R$ ${change.toFixed(2)}`;
            document.getElementById('changeAmount').className = change >= 0 ? 'text-lg font-bold text-blue-600' : 'text-lg font-bold text-red-600';
        }

        function generateSaleReceipt() {
            if (cart.length === 0) {
                showNotification('Carrinho vazio!', 'error');
                return;
            }
            
            try {
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const paymentMethod = document.getElementById('paymentMethod').value;
                const received = parseFloat(document.getElementById('amountReceived').value) || 0;
                
                // For PIX and card payments, set received amount equal to total
                // For cash, use the entered amount or default to total if not specified
                const finalReceived = paymentMethod === 'dinheiro' ? (received > 0 ? received : total) : total;
                const change = finalReceived - total;
                
                // Check if jsPDF is available
                if (typeof window.jspdf === 'undefined' && typeof window.jsPDF === 'undefined') {
                    showNotification('Erro: Biblioteca PDF n√£o carregada. Tente recarregar a p√°gina.', 'error');
                    return;
                }
                
                // Get jsPDF constructor
                const { jsPDF } = window.jspdf || window;
                
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(20);
                doc.setTextColor(0, 100, 200);
                doc.text('PAPEL E ARTE', 20, 25);
                
                doc.setFontSize(12);
                doc.setTextColor(100, 100, 100);
                doc.text('Comprovante de Venda', 20, 35);
                
                // Date and receipt number
                doc.setFontSize(10);
                doc.text('Data: ' + new Date().toLocaleDateString('pt-BR'), 20, 50);
                doc.text('Hora: ' + new Date().toLocaleTimeString('pt-BR'), 20, 60);
                doc.text('Comprovante No: ' + Date.now().toString().slice(-8), 20, 70);
                doc.text('Atendente: ' + currentUser, 20, 80);
                
                // Items
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text('ITENS DA VENDA:', 20, 100);
                
                let yPos = 115;
                doc.setFontSize(10);
                
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    doc.text(item.quantity + 'x ' + item.name, 25, yPos);
                    doc.text('R$ ' + item.price.toFixed(2) + ' cada', 120, yPos);
                    doc.text('R$ ' + itemTotal.toFixed(2), 160, yPos);
                    yPos += 10;
                });
                
                // Line separator
                doc.line(20, yPos + 5, 190, yPos + 5);
                yPos += 15;
                
                // Payment details
                const paymentMethodDisplay = {
                    'dinheiro': 'Dinheiro',
                    'pix': 'PIX',
                    'cartao': 'Cartao'
                };
                
                doc.setFontSize(12);
                doc.text('TOTAL: R$ ' + total.toFixed(2), 25, yPos);
                yPos += 15;
                
                doc.text('Forma de Pagamento: ' + (paymentMethodDisplay[paymentMethod] || 'Dinheiro'), 25, yPos);
                yPos += 10;
                
                if (paymentMethod === 'dinheiro') {
                    doc.text('Valor Recebido: R$ ' + finalReceived.toFixed(2), 25, yPos);
                    yPos += 10;
                    doc.text('Troco: R$ ' + change.toFixed(2), 25, yPos);
                    yPos += 10;
                }
                
                // Footer
                yPos += 20;
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text('Obrigado pela preferencia!', 20, yPos);
                doc.text('Sistema Papel e Arte - Point of Sale', 20, yPos + 10);
                
                // Save PDF
                const fileName = 'comprovante-venda-' + Date.now() + '.pdf';
                doc.save(fileName);
                
                showNotification('Comprovante PDF gerado com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showNotification('Erro ao gerar PDF. Verifique se o navegador permite downloads.', 'error');
            }
        }

        function finalizeSale() {
            if (cart.length === 0) return;
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const paymentMethod = document.getElementById('paymentMethod').value;
            const received = parseFloat(document.getElementById('amountReceived').value) || 0;
            
            // For PIX and card payments, set received amount equal to total
            // For cash, use the entered amount or default to total if not specified
            const finalReceived = paymentMethod === 'dinheiro' ? (received > 0 ? received : total) : total;
            
            // Create sale record
            const sale = {
                id: Date.now(),
                date: new Date().toISOString(),
                items: [...cart],
                total: total,
                received: finalReceived,
                change: finalReceived - total,
                paymentMethod: paymentMethod,
                employee: currentUser,
                storeId: currentStore
            };
            
            sales.push(sale);
            localStorage.setItem('pdv_sales', JSON.stringify(sales));
            
            // Update stock and create movements
            cart.forEach(item => {
                const product = products.find(p => p.id === item.id);
                if (product) {
                    product.stock -= item.quantity;
                    product.sales = (product.sales || 0) + item.quantity;
                    
                    // Create stock movement
                    const movement = {
                        id: Date.now() + Math.random(),
                        date: new Date().toISOString(),
                        productId: product.id,
                        productName: product.name,
                        type: 'saida',
                        quantity: item.quantity,
                        reason: 'Venda',
                        employee: currentUser
                    };
                    stockMovements.push(movement);
                }
            });
            
            localStorage.setItem('pdv_products', JSON.stringify(products));
            localStorage.setItem('pdv_stock_movements', JSON.stringify(stockMovements));
            
            // Clear cart and form
            cart = [];
            document.getElementById('amountReceived').value = '';
            document.getElementById('paymentMethod').value = 'dinheiro';
            handlePaymentMethodChange();
            updateCartDisplay();
            loadProducts();
            loadStockMovements();
            updateLowStockAlerts();
            updateSalesSummary();
            loadSalesHistory();
            
            showNotification(`Venda finalizada! Troco: R$ ${(received - total).toFixed(2)}`, 'success');
        }

        // Employee management
        function loadEmployees() {
            const table = document.getElementById('employeesTable');
            if (!table) return;
            
            table.innerHTML = '';
            
            // Show all employees for admin, or filter by store for others
            const filteredEmployees = userRole === 'Administrador' ? 
                employees : 
                employees.filter(emp => emp.storeId === currentStore);
            
            filteredEmployees.forEach(employee => {
                const permissions = employee.permissions || { pos: false, products: false, inventory: false, reports: false, calculator: false, quote: false };
                const permissionIcons = [];
                
                if (permissions.pos) permissionIcons.push('üõí');
                if (permissions.products) permissionIcons.push('üì¶');
                if (permissions.inventory) permissionIcons.push('üìä');
                if (permissions.reports) permissionIcons.push('üìà');
                if (permissions.calculator) permissionIcons.push('üìê');
                if (permissions.quote) permissionIcons.push('üí¨');
                
                const permissionText = permissionIcons.length > 0 ? permissionIcons.join(' ') : '‚ùå';
                
                const storeName = stores.find(s => s.id === employee.storeId)?.name || 'N/A';
                
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-2">${employee.name}</td>
                    <td class="px-4 py-2">${employee.role}</td>
                    <td class="px-4 py-2">
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">${storeName}</span>
                    </td>
                    <td class="px-4 py-2">${employee.phone}</td>
                    <td class="px-4 py-2">${employee.email}</td>
                    <td class="px-4 py-2">${new Date(employee.hireDate).toLocaleDateString('pt-BR')}</td>
                    <td class="px-4 py-2">
                        <div class="text-lg">${permissionText}</div>
                        <div class="text-xs text-gray-500">
                            ${permissions.pos ? 'Vendas ' : ''}
                            ${permissions.products ? 'Produtos ' : ''}
                            ${permissions.inventory ? 'Estoque ' : ''}
                            ${permissions.reports ? 'Relat√≥rios ' : ''}
                            ${permissions.calculator ? 'Calculadora ' : ''}
                            ${permissions.quote ? 'Or√ßamento' : ''}
                        </div>
                    </td>
                    <td class="px-4 py-2">
                        <button onclick="editEmployee(${employee.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-sm mr-1">
                            Editar
                        </button>
                        <button onclick="deleteEmployee(${employee.id})" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-sm">
                            Deletar
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function showEmployeeForm() {
            editingEmployeeId = null;
            document.getElementById('employeeModalTitle').textContent = 'Novo Funcion√°rio';
            document.getElementById('employeeName').value = '';
            document.getElementById('employeeRole').value = '';
            document.getElementById('employeePhone').value = '';
            document.getElementById('employeeEmail').value = '';
            document.getElementById('employeeHireDate').value = '';
            document.getElementById('employeeUsername').value = '';
            document.getElementById('employeePassword').value = '';
            document.getElementById('employeeStore').value = '';
            
            // Reset permissions
            document.getElementById('permissionPOS').checked = true;
            document.getElementById('permissionProducts').checked = false;
            document.getElementById('permissionInventory').checked = false;
            document.getElementById('permissionReports').checked = false;
            document.getElementById('permissionCalculator').checked = false;
            document.getElementById('permissionQuote').checked = false;
            
            document.getElementById('employeeModal').classList.remove('hidden');
        }

        function hideEmployeeForm() {
            document.getElementById('employeeModal').classList.add('hidden');
        }

        function editEmployee(id) {
            const employee = employees.find(e => e.id === id);
            if (employee) {
                editingEmployeeId = id;
                document.getElementById('employeeModalTitle').textContent = 'Editar Funcion√°rio';
                document.getElementById('employeeName').value = employee.name;
                document.getElementById('employeeRole').value = employee.role;
                document.getElementById('employeePhone').value = employee.phone;
                document.getElementById('employeeEmail').value = employee.email;
                document.getElementById('employeeHireDate').value = employee.hireDate;
                document.getElementById('employeeUsername').value = employee.username;
                document.getElementById('employeePassword').value = employee.password;
                document.getElementById('employeeStore').value = employee.storeId || '';
                
                // Set permissions
                const permissions = employee.permissions || { pos: true, products: false, inventory: false, reports: false, calculator: false, quote: false };
                document.getElementById('permissionPOS').checked = permissions.pos;
                document.getElementById('permissionProducts').checked = permissions.products;
                document.getElementById('permissionInventory').checked = permissions.inventory;
                document.getElementById('permissionReports').checked = permissions.reports;
                document.getElementById('permissionCalculator').checked = permissions.calculator;
                document.getElementById('permissionQuote').checked = permissions.quote;
                
                document.getElementById('employeeModal').classList.remove('hidden');
            }
        }

        function saveEmployee(event) {
            event.preventDefault();
            
            const employeeData = {
                name: document.getElementById('employeeName').value,
                role: document.getElementById('employeeRole').value,
                storeId: parseInt(document.getElementById('employeeStore').value),
                phone: document.getElementById('employeePhone').value,
                email: document.getElementById('employeeEmail').value,
                hireDate: document.getElementById('employeeHireDate').value,
                username: document.getElementById('employeeUsername').value,
                password: document.getElementById('employeePassword').value,
                permissions: {
                    pos: document.getElementById('permissionPOS').checked,
                    products: document.getElementById('permissionProducts').checked,
                    inventory: document.getElementById('permissionInventory').checked,
                    reports: document.getElementById('permissionReports').checked,
                    calculator: document.getElementById('permissionCalculator').checked,
                    quote: document.getElementById('permissionQuote').checked
                }
            };
            
            if (editingEmployeeId) {
                const index = employees.findIndex(e => e.id === editingEmployeeId);
                employees[index] = { ...employees[index], ...employeeData };
                showNotification('Funcion√°rio atualizado com sucesso!', 'success');
            } else {
                const newId = Math.max(...employees.map(e => e.id), 0) + 1;
                employees.push({ id: newId, ...employeeData });
                showNotification('Funcion√°rio cadastrado com sucesso!', 'success');
            }
            
            localStorage.setItem('pdv_employees', JSON.stringify(employees));
            loadEmployees();
            hideEmployeeForm();
        }

        function deleteEmployee(id) {
            if (confirm('Tem certeza que deseja deletar este funcion√°rio?')) {
                employees = employees.filter(e => e.id !== id);
                localStorage.setItem('pdv_employees', JSON.stringify(employees));
                loadEmployees();
                showNotification('Funcion√°rio deletado com sucesso!', 'success');
            }
        }

        // Stock management
        function loadStockMovements() {
            const container = document.getElementById('stockMovements');
            container.innerHTML = '';
            
            const recentMovements = stockMovements.slice(-20).reverse();
            
            recentMovements.forEach(movement => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center p-3 bg-gray-50 rounded';
                
                const typeClass = movement.type === 'entrada' ? 'text-green-600' : 'text-red-600';
                const typeIcon = movement.type === 'entrada' ? 'üìà' : 'üìâ';
                
                div.innerHTML = `
                    <div>
                        <div class="font-medium">${movement.productName}</div>
                        <div class="text-sm text-gray-500">${movement.reason} - ${movement.employee}</div>
                        <div class="text-xs text-gray-400">${new Date(movement.date).toLocaleString('pt-BR')}</div>
                    </div>
                    <div class="text-right">
                        <div class="${typeClass} font-bold">${typeIcon} ${movement.quantity}</div>
                    </div>
                `;
                container.appendChild(div);
            });
            
            if (recentMovements.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhuma movimenta√ß√£o registrada</p>';
            }
        }

        function updateLowStockAlerts() {
            const container = document.getElementById('lowStockAlerts');
            container.innerHTML = '';
            
            const lowStockProducts = products.filter(p => p.stock <= p.minStock);
            
            lowStockProducts.forEach(product => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center p-3 bg-red-50 border border-red-200 rounded low-stock';
                div.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <span class="text-2xl">${product.emoji}</span>
                        <div>
                            <div class="font-medium text-red-800">${product.name}</div>
                            <div class="text-sm text-red-600">Estoque atual: ${product.stock}</div>
                        </div>
                    </div>
                    <div class="text-red-600 font-bold">‚ö†Ô∏è</div>
                `;
                container.appendChild(div);
            });
            
            if (lowStockProducts.length === 0) {
                container.innerHTML = '<p class="text-green-600 text-center py-8">‚úÖ Todos os produtos com estoque adequado</p>';
            }
        }

        // Reports
        function loadSalesHistory() {
            const table = document.getElementById('salesHistory');
            table.innerHTML = '';
            
            // Filter sales by current store
            const storeSales = sales.filter(sale => sale.storeId === currentStore);
            const recentSales = storeSales.slice(-20).reverse();
            
            recentSales.forEach(sale => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                
                const itemsText = sale.items.map(item => `${item.quantity}x ${item.name}`).join(', ');
                
                // Payment method display with icons
                const paymentMethodDisplay = {
                    'dinheiro': 'üíµ Dinheiro',
                    'pix': 'üì± PIX',
                    'cartao': 'üí≥ Cart√£o'
                };
                
                const paymentMethod = sale.paymentMethod || 'dinheiro';
                
                row.innerHTML = `
                    <td class="px-4 py-2">
                        <div>${new Date(sale.date).toLocaleDateString('pt-BR')}</div>
                        <div class="text-sm text-gray-500">${new Date(sale.date).toLocaleTimeString('pt-BR')}</div>
                    </td>
                    <td class="px-4 py-2">
                        <div class="text-sm">${itemsText}</div>
                    </td>
                    <td class="px-4 py-2 font-bold text-green-600">R$ ${sale.total.toFixed(2)}</td>
                    <td class="px-4 py-2">
                        <span class="text-sm">${paymentMethodDisplay[paymentMethod]}</span>
                    </td>
                    <td class="px-4 py-2">${sale.employee}</td>
                `;
                table.appendChild(row);
            });
            
            if (recentSales.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="5" class="px-4 py-8 text-center text-gray-500">Nenhuma venda registrada nesta loja</td>';
                table.appendChild(row);
            }
        }

        function updateSalesSummary() {
            const container = document.getElementById('salesSummary');
            const today = new Date();
            const todayStr = today.toDateString();
            
            // Filter sales by current store
            const storeSales = sales.filter(sale => sale.storeId === currentStore);
            
            // Today's sales for current store
            const todaySales = storeSales.filter(sale => new Date(sale.date).toDateString() === todayStr);
            const todayTotal = todaySales.reduce((sum, sale) => sum + sale.total, 0);
            
            // This week's sales for current store
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay());
            const weekSales = storeSales.filter(sale => new Date(sale.date) >= weekStart);
            const weekTotal = weekSales.reduce((sum, sale) => sum + sale.total, 0);
            
            // This month's sales for current store
            const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            const monthSales = storeSales.filter(sale => new Date(sale.date) >= monthStart);
            const monthTotal = monthSales.reduce((sum, sale) => sum + sale.total, 0);
            
            // Payment method breakdown for today (current store only)
            const todayByPayment = {
                dinheiro: todaySales.filter(s => (s.paymentMethod || 'dinheiro') === 'dinheiro').reduce((sum, s) => sum + s.total, 0),
                pix: todaySales.filter(s => s.paymentMethod === 'pix').reduce((sum, s) => sum + s.total, 0),
                cartao: todaySales.filter(s => s.paymentMethod === 'cartao').reduce((sum, s) => sum + s.total, 0)
            };

            const storeName = stores.find(s => s.id === currentStore)?.name || 'Loja';

            container.innerHTML = `
                <div class="bg-gray-100 p-2 rounded mb-3">
                    <div class="text-sm font-bold text-gray-700">üìç ${storeName}</div>
                    <div class="text-xs text-gray-500">Relat√≥rios desta loja apenas</div>
                </div>
                <div class="bg-blue-50 p-3 rounded">
                    <div class="text-sm text-blue-600">Vendas Hoje</div>
                    <div class="text-xl font-bold text-blue-800">R$ ${todayTotal.toFixed(2)}</div>
                    <div class="text-sm text-blue-600">${todaySales.length} vendas</div>
                    <div class="text-xs text-blue-500 mt-1">
                        üíµ R$ ${todayByPayment.dinheiro.toFixed(2)} | 
                        üì± R$ ${todayByPayment.pix.toFixed(2)} | 
                        üí≥ R$ ${todayByPayment.cartao.toFixed(2)}
                    </div>
                </div>
                <div class="bg-green-50 p-3 rounded">
                    <div class="text-sm text-green-600">Esta Semana</div>
                    <div class="text-xl font-bold text-green-800">R$ ${weekTotal.toFixed(2)}</div>
                    <div class="text-sm text-green-600">${weekSales.length} vendas</div>
                </div>
                <div class="bg-purple-50 p-3 rounded">
                    <div class="text-sm text-purple-600">Este M√™s</div>
                    <div class="text-xl font-bold text-purple-800">R$ ${monthTotal.toFixed(2)}</div>
                    <div class="text-sm text-purple-600">${monthSales.length} vendas</div>
                </div>
            `;
        }

        function generateReport(period) {
            const today = new Date();
            let filteredSales = [];
            let periodName = '';
            
            // First filter by current store
            const storeSales = sales.filter(sale => sale.storeId === currentStore);
            
            switch(period) {
                case 'daily':
                    filteredSales = storeSales.filter(sale => new Date(sale.date).toDateString() === today.toDateString());
                    periodName = 'Hoje';
                    break;
                case 'weekly':
                    const weekStart = new Date(today);
                    weekStart.setDate(today.getDate() - today.getDay());
                    filteredSales = storeSales.filter(sale => new Date(sale.date) >= weekStart);
                    periodName = 'Esta Semana';
                    break;
                case 'monthly':
                    const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                    filteredSales = storeSales.filter(sale => new Date(sale.date) >= monthStart);
                    periodName = 'Este M√™s';
                    break;
            }
            
            const total = filteredSales.reduce((sum, sale) => sum + sale.total, 0);
            const storeName = stores.find(s => s.id === currentStore)?.name || 'Loja';
            showNotification(`${storeName} - ${periodName}: ${filteredSales.length} vendas - R$ ${total.toFixed(2)}`, 'info');
        }

        function exportToPDF() {
            try {
                // Check if jsPDF is available
                if (typeof window.jspdf === 'undefined' && typeof window.jsPDF === 'undefined') {
                    showNotification('Erro: Biblioteca PDF n√£o carregada. Tente recarregar a p√°gina.', 'error');
                    return;
                }
                
                // Get jsPDF constructor
                const { jsPDF } = window.jspdf || window;
                
                const doc = new jsPDF();
                const storeName = stores.find(s => s.id === currentStore)?.name || 'Loja';
                
                doc.setFontSize(20);
                doc.text('Relatorio de Vendas - Papel e Arte', 20, 20);
                
                doc.setFontSize(14);
                doc.text('Loja: ' + storeName, 20, 35);
                
                doc.setFontSize(12);
                doc.text('Gerado em: ' + new Date().toLocaleString('pt-BR'), 20, 45);
                
                // Filter sales by current store
                const storeSales = sales.filter(sale => sale.storeId === currentStore);
                const today = new Date();
                const todaySales = storeSales.filter(sale => new Date(sale.date).toDateString() === today.toDateString());
                const todayTotal = todaySales.reduce((sum, sale) => sum + sale.total, 0);
                
                doc.text('Vendas de Hoje: ' + todaySales.length + ' vendas', 20, 60);
                doc.text('Total de Hoje: R$ ' + todayTotal.toFixed(2), 20, 70);
                
                doc.text('Ultimas 10 Vendas desta Loja:', 20, 90);
                
                const recentSales = storeSales.slice(-10).reverse();
                let yPos = 105;
                
                recentSales.forEach((sale, index) => {
                    const date = new Date(sale.date).toLocaleString('pt-BR');
                    const itemsText = sale.items.map(item => item.quantity + 'x ' + item.name).join(', ');
                    const paymentMethodText = {
                        'dinheiro': 'Dinheiro',
                        'pix': 'PIX',
                        'cartao': 'Cartao'
                    };
                    const paymentMethod = paymentMethodText[sale.paymentMethod || 'dinheiro'];
                    
                    doc.text((index + 1) + '. ' + date + ' - R$ ' + sale.total.toFixed(2) + ' (' + paymentMethod + ')', 20, yPos);
                    doc.text('   ' + itemsText, 20, yPos + 10);
                    doc.text('   Funcionario: ' + sale.employee, 20, yPos + 20);
                    yPos += 30;
                    
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 20;
                    }
                });
                
                // Add store info to filename
                const storeCode = storeName.replace(/\s+/g, '-').toLowerCase();
                doc.save('relatorio-vendas-' + storeCode + '.pdf');
                showNotification('Relat√≥rio PDF gerado com sucesso para ' + storeName + '!', 'success');
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showNotification('Erro ao gerar PDF. Verifique se o navegador permite downloads.', 'error');
            }
        }

        // Utility functions
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 bounce-in ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                type === 'warning' ? 'bg-yellow-500 text-white' :
                'bg-blue-500 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Quote Functions
        function loadQuoteProducts() {
            const grid = document.getElementById('quoteProductsGrid');
            
            if (!grid) return;
            
            grid.innerHTML = '';
            
            // Filter products by current store
            const storeProducts = products.filter(product => 
                !product.storeId || product.storeId === currentStore
            );
            
            storeProducts.forEach(product => {
                // Product card for Quote
                const card = document.createElement('div');
                card.className = 'product-card bg-white border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-green-500 transition-all';
                card.onclick = () => addToQuote(product);
                
                const stockClass = product.stock <= product.minStock ? 'text-red-500 low-stock' : 'text-green-600';
                
                card.innerHTML = `
                    <div class="text-center">
                        <div class="text-4xl mb-2">${product.emoji}</div>
                        <h3 class="font-semibold text-gray-800 mb-1">${product.name}</h3>
                        <p class="text-lg font-bold text-green-600">R$ ${product.price.toFixed(2)}</p>
                        <p class="text-sm ${stockClass}">Estoque: ${product.stock}</p>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function searchQuoteProducts() {
            const searchTerm = document.getElementById('quoteProductSearch').value.toLowerCase();
            const cards = document.querySelectorAll('#quoteProductsGrid .product-card');
            
            cards.forEach(card => {
                const productName = card.querySelector('h3').textContent.toLowerCase();
                if (productName.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function showQuoteFavorites() {
            const cards = document.querySelectorAll('#quoteProductsGrid .product-card');
            const favoriteProducts = products.sort((a, b) => (b.sales || 0) - (a.sales || 0)).slice(0, 6);
            
            cards.forEach((card, index) => {
                const productName = card.querySelector('h3').textContent;
                const isFavorite = favoriteProducts.some(fav => fav.name === productName);
                card.style.display = isFavorite ? 'block' : 'none';
            });
        }

        function addToQuote(product) {
            const existingItem = quote.find(item => item.id === product.id);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                quote.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1,
                    emoji: product.emoji,
                    description: product.description
                });
            }
            
            updateQuoteDisplay();
            showNotification(`${product.name} adicionado ao or√ßamento!`, 'success');
        }

        function removeFromQuote(productId) {
            quote = quote.filter(item => item.id !== productId);
            updateQuoteDisplay();
        }

        function updateQuoteQuantity(productId, change) {
            const item = quote.find(item => item.id === productId);
            
            if (item) {
                const newQuantity = item.quantity + change;
                if (newQuantity <= 0) {
                    removeFromQuote(productId);
                } else {
                    item.quantity = newQuantity;
                    updateQuoteDisplay();
                }
            }
        }

        function updateQuoteDisplay() {
            const quoteItems = document.getElementById('quoteItems');
            const quoteTotal = document.getElementById('quoteTotal');
            const generateQuoteBtn = document.getElementById('generateQuoteBtn');
            
            if (quote.length === 0) {
                quoteItems.innerHTML = '<p class="text-gray-500 text-center py-8">Or√ßamento vazio</p>';
                quoteTotal.textContent = 'R$ 0,00';
                generateQuoteBtn.disabled = true;
                return;
            }
            
            let total = 0;
            quoteItems.innerHTML = '';
            
            quote.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex items-center justify-between bg-gray-50 p-2 rounded';
                itemDiv.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <span class="text-lg">${item.emoji}</span>
                        <div>
                            <div class="font-medium text-sm">${item.name}</div>
                            <div class="text-xs text-gray-500">R$ ${item.price.toFixed(2)} cada</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-1">
                        <button onclick="updateQuoteQuantity(${item.id}, -1)" class="bg-red-500 hover:bg-red-600 text-white w-6 h-6 rounded text-xs">-</button>
                        <span class="mx-2 font-medium">${item.quantity}</span>
                        <button onclick="updateQuoteQuantity(${item.id}, 1)" class="bg-green-500 hover:bg-green-600 text-white w-6 h-6 rounded text-xs">+</button>
                        <button onclick="removeFromQuote(${item.id})" class="bg-gray-500 hover:bg-gray-600 text-white w-6 h-6 rounded text-xs ml-2">√ó</button>
                    </div>
                `;
                quoteItems.appendChild(itemDiv);
            });
            
            quoteTotal.textContent = `R$ ${total.toFixed(2)}`;
            generateQuoteBtn.disabled = false;
        }

        function generateQuoteText() {
            if (quote.length === 0) {
                showNotification('Or√ßamento vazio!', 'error');
                return;
            }
            
            const customerName = document.getElementById('customerName').value || 'Cliente';
            const notes = document.getElementById('quoteNotes').value;
            const total = quote.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const storeName = stores.find(s => s.id === currentStore)?.name || 'Papel e Arte';
            
            let quoteText = `üé® *${storeName.toUpperCase()}*\n`;
            quoteText += `üìã *OR√áAMENTO*\n\n`;
            quoteText += `üë§ *Cliente:* ${customerName}\n`;
            quoteText += `üìÖ *Data:* ${new Date().toLocaleDateString('pt-BR')}\n`;
            quoteText += `‚è∞ *Hora:* ${new Date().toLocaleTimeString('pt-BR')}\n\n`;
            
            quoteText += `üì¶ *ITENS DO OR√áAMENTO:*\n`;
            quoteText += `${'‚îÄ'.repeat(30)}\n`;
            
            quote.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                quoteText += `${index + 1}. ${item.emoji} *${item.name}*\n`;
                quoteText += `   Qtd: ${item.quantity}x | Valor: R$ ${item.price.toFixed(2)}\n`;
                quoteText += `   Subtotal: R$ ${itemTotal.toFixed(2)}\n\n`;
            });
            
            quoteText += `${'‚îÄ'.repeat(30)}\n`;
            quoteText += `üí∞ *VALOR TOTAL: R$ ${total.toFixed(2)}*\n\n`;
            
            if (notes) {
                quoteText += `üìù *Observa√ß√µes:*\n${notes}\n\n`;
            }
            
            quoteText += `‚úÖ *Validade:* 15 dias\n`;
            quoteText += `üìû *Contato:* Entre em contato para mais informa√ß√µes\n`;
            quoteText += `üè™ *${storeName}* - Comunica√ß√£o Visual\n`;
            quoteText += `\n_Or√ßamento gerado pelo Sistema Papel e Arte_`;
            
            document.getElementById('quoteTextContent').value = quoteText;
            document.getElementById('quoteTextModal').classList.remove('hidden');
        }

        function copyQuoteText() {
            const textArea = document.getElementById('quoteTextContent');
            textArea.select();
            textArea.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                showNotification('Texto copiado! Cole no WhatsApp.', 'success');
            } catch (err) {
                // Fallback for modern browsers
                navigator.clipboard.writeText(textArea.value).then(() => {
                    showNotification('Texto copiado! Cole no WhatsApp.', 'success');
                }).catch(() => {
                    showNotification('Erro ao copiar. Selecione e copie manualmente.', 'error');
                });
            }
        }

        function hideQuoteTextModal() {
            document.getElementById('quoteTextModal').classList.add('hidden');
            // Reset edit mode when closing
            const textArea = document.getElementById('quoteTextContent');
            const editBtn = document.getElementById('editToggleBtn');
            textArea.readOnly = true;
            textArea.classList.remove('bg-yellow-50', 'border-yellow-400');
            textArea.classList.add('bg-gray-50');
            editBtn.innerHTML = '‚úèÔ∏è Editar';
            editBtn.className = 'text-sm bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded transition-colors';
        }

        function toggleEditMode() {
            const textArea = document.getElementById('quoteTextContent');
            const editBtn = document.getElementById('editToggleBtn');
            
            if (textArea.readOnly) {
                // Enable editing
                textArea.readOnly = false;
                textArea.focus();
                textArea.classList.remove('bg-gray-50');
                textArea.classList.add('bg-yellow-50', 'border-yellow-400');
                editBtn.innerHTML = 'üíæ Salvar';
                editBtn.className = 'text-sm bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded transition-colors';
                showNotification('Modo de edi√ß√£o ativado! Edite o texto conforme necess√°rio.', 'info');
            } else {
                // Disable editing
                textArea.readOnly = true;
                textArea.classList.remove('bg-yellow-50', 'border-yellow-400');
                textArea.classList.add('bg-gray-50');
                editBtn.innerHTML = '‚úèÔ∏è Editar';
                editBtn.className = 'text-sm bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded transition-colors';
                showNotification('Altera√ß√µes salvas! Texto pronto para copiar.', 'success');
            }
        }

        function regenerateQuoteText() {
            if (quote.length === 0) {
                showNotification('Or√ßamento vazio!', 'error');
                return;
            }
            
            // Regenerate the original text
            const customerName = document.getElementById('customerName').value || 'Cliente';
            const notes = document.getElementById('quoteNotes').value;
            const total = quote.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const storeName = stores.find(s => s.id === currentStore)?.name || 'Papel e Arte';
            
            let quoteText = `üé® *${storeName.toUpperCase()}*\n`;
            quoteText += `üìã *OR√áAMENTO*\n\n`;
            quoteText += `üë§ *Cliente:* ${customerName}\n`;
            quoteText += `üìÖ *Data:* ${new Date().toLocaleDateString('pt-BR')}\n`;
            quoteText += `‚è∞ *Hora:* ${new Date().toLocaleTimeString('pt-BR')}\n\n`;
            
            quoteText += `üì¶ *ITENS DO OR√áAMENTO:*\n`;
            quoteText += `${'‚îÄ'.repeat(30)}\n`;
            
            quote.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                quoteText += `${index + 1}. ${item.emoji} *${item.name}*\n`;
                quoteText += `   Qtd: ${item.quantity}x | Valor: R$ ${item.price.toFixed(2)}\n`;
                quoteText += `   Subtotal: R$ ${itemTotal.toFixed(2)}\n\n`;
            });
            
            quoteText += `${'‚îÄ'.repeat(30)}\n`;
            quoteText += `üí∞ *VALOR TOTAL: R$ ${total.toFixed(2)}*\n\n`;
            
            if (notes) {
                quoteText += `üìù *Observa√ß√µes:*\n${notes}\n\n`;
            }
            
            quoteText += `‚úÖ *Validade:* 15 dias\n`;
            quoteText += `üìû *Contato:* Entre em contato para mais informa√ß√µes\n`;
            quoteText += `üè™ *${storeName}* - Comunica√ß√£o Visual\n`;
            quoteText += `\n_Or√ßamento gerado pelo Sistema Papel e Arte_`;
            
            document.getElementById('quoteTextContent').value = quoteText;
            
            // Reset edit mode
            const textArea = document.getElementById('quoteTextContent');
            const editBtn = document.getElementById('editToggleBtn');
            textArea.readOnly = true;
            textArea.classList.remove('bg-yellow-50', 'border-yellow-400');
            textArea.classList.add('bg-gray-50');
            editBtn.innerHTML = '‚úèÔ∏è Editar';
            editBtn.className = 'text-sm bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded transition-colors';
            
            showNotification('Texto regenerado com os dados atuais!', 'success');
        }

        function clearQuote() {
            if (quote.length === 0) return;
            
            if (confirm('Tem certeza que deseja limpar o or√ßamento?')) {
                quote = [];
                document.getElementById('customerName').value = '';
                document.getElementById('quoteNotes').value = '';
                updateQuoteDisplay();
                showNotification('Or√ßamento limpo!', 'success');
            }
        }

        // Material Calculator Functions
        function loadMaterials() {
            const table = document.getElementById('materialsTable');
            const select = document.getElementById('selectedMaterial');
            
            table.innerHTML = '';
            select.innerHTML = '<option value="">Selecione um material...</option>';
            
            materials.forEach(material => {
                // Add to table
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-2">
                        <div class="font-medium">${material.name}</div>
                        <div class="text-sm text-gray-500">${material.description}</div>
                    </td>
                    <td class="px-4 py-2 font-bold text-green-600">R$ ${material.price.toFixed(2)}</td>
                    <td class="px-4 py-2">
                        <button onclick="editMaterial(${material.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-sm mr-1">
                            Editar
                        </button>
                        <button onclick="deleteMaterial(${material.id})" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-sm">
                            Deletar
                        </button>
                    </td>
                `;
                table.appendChild(row);
                
                // Add to select
                const option = document.createElement('option');
                option.value = material.id;
                option.textContent = `${material.name} - R$ ${material.price.toFixed(2)}/m¬≤`;
                select.appendChild(option);
            });
        }

        function showMaterialForm() {
            editingMaterialId = null;
            document.getElementById('materialModalTitle').textContent = 'Novo Material';
            document.getElementById('materialNameInput').value = '';
            document.getElementById('materialPriceInput').value = '';
            document.getElementById('materialDescriptionInput').value = '';
            document.getElementById('materialModal').classList.remove('hidden');
        }

        function hideMaterialForm() {
            document.getElementById('materialModal').classList.add('hidden');
        }

        function editMaterial(id) {
            const material = materials.find(m => m.id === id);
            if (material) {
                editingMaterialId = id;
                document.getElementById('materialModalTitle').textContent = 'Editar Material';
                document.getElementById('materialNameInput').value = material.name;
                document.getElementById('materialPriceInput').value = material.price;
                document.getElementById('materialDescriptionInput').value = material.description;
                document.getElementById('materialModal').classList.remove('hidden');
            }
        }

        function saveMaterial(event) {
            event.preventDefault();
            
            const materialData = {
                name: document.getElementById('materialNameInput').value,
                price: parseFloat(document.getElementById('materialPriceInput').value),
                description: document.getElementById('materialDescriptionInput').value
            };
            
            if (editingMaterialId) {
                const index = materials.findIndex(m => m.id === editingMaterialId);
                materials[index] = { ...materials[index], ...materialData };
                showNotification('Material atualizado com sucesso!', 'success');
            } else {
                const newId = Math.max(...materials.map(m => m.id), 0) + 1;
                materials.push({ id: newId, ...materialData });
                showNotification('Material cadastrado com sucesso!', 'success');
            }
            
            localStorage.setItem('pdv_materials', JSON.stringify(materials));
            loadMaterials();
            hideMaterialForm();
        }

        function deleteMaterial(id) {
            if (confirm('Tem certeza que deseja deletar este material?')) {
                materials = materials.filter(m => m.id !== id);
                localStorage.setItem('pdv_materials', JSON.stringify(materials));
                loadMaterials();
                showNotification('Material deletado com sucesso!', 'success');
            }
        }

        function updateMaterialPrice() {
            const selectedId = document.getElementById('selectedMaterial').value;
            const material = materials.find(m => m.id == selectedId);
            
            if (material) {
                document.getElementById('pricePerMeter').textContent = `R$ ${material.price.toFixed(2)}`;
                calculatePreview();
            } else {
                document.getElementById('pricePerMeter').textContent = 'R$ 0,00';
                document.getElementById('totalArea').textContent = '0,00 m¬≤';
                document.getElementById('totalPrice').textContent = 'R$ 0,00';
            }
        }

        function toggleMeasurementUnit() {
            const unit = document.querySelector('input[name="measurementUnit"]:checked').value;
            const widthLabel = document.getElementById('widthLabel');
            const heightLabel = document.getElementById('heightLabel');
            const widthInput = document.getElementById('materialWidth');
            const heightInput = document.getElementById('materialHeight');
            
            if (unit === 'centimeters') {
                widthLabel.textContent = 'Largura (cent√≠metros)';
                heightLabel.textContent = 'Altura (cent√≠metros)';
                widthInput.step = '1';
                heightInput.step = '1';
                widthInput.placeholder = 'Ex: 100';
                heightInput.placeholder = 'Ex: 150';
            } else {
                widthLabel.textContent = 'Largura (metros)';
                heightLabel.textContent = 'Altura (metros)';
                widthInput.step = '0.01';
                heightInput.step = '0.01';
                widthInput.placeholder = 'Ex: 1.00';
                heightInput.placeholder = 'Ex: 1.50';
            }
            
            // Clear inputs when switching units
            widthInput.value = '';
            heightInput.value = '';
            calculatePreview();
        }

        function calculatePreview() {
            const width = parseFloat(document.getElementById('materialWidth').value) || 0;
            const height = parseFloat(document.getElementById('materialHeight').value) || 0;
            const selectedId = document.getElementById('selectedMaterial').value;
            const material = materials.find(m => m.id == selectedId);
            const unit = document.querySelector('input[name="measurementUnit"]:checked').value;
            
            // Convert to meters if input is in centimeters
            let widthInMeters = width;
            let heightInMeters = height;
            
            if (unit === 'centimeters') {
                widthInMeters = width / 100;
                heightInMeters = height / 100;
            }
            
            const area = widthInMeters * heightInMeters;
            document.getElementById('totalArea').textContent = `${area.toFixed(2)} m¬≤`;
            
            if (material && area > 0) {
                const total = area * material.price;
                document.getElementById('totalPrice').textContent = `R$ ${total.toFixed(2)}`;
            } else {
                document.getElementById('totalPrice').textContent = 'R$ 0,00';
            }
        }

        function generateQuotePDF() {
            const selectedId = document.getElementById('selectedMaterial').value;
            const material = materials.find(m => m.id == selectedId);
            const width = parseFloat(document.getElementById('materialWidth').value) || 0;
            const height = parseFloat(document.getElementById('materialHeight').value) || 0;
            const notes = document.getElementById('materialNotes').value;
            
            if (!material || width <= 0 || height <= 0) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'error');
                return;
            }
            
            try {
                // Check if jsPDF is available
                if (typeof window.jspdf === 'undefined' && typeof window.jsPDF === 'undefined') {
                    showNotification('Erro: Biblioteca PDF n√£o carregada. Tente recarregar a p√°gina.', 'error');
                    return;
                }
                
                // Get jsPDF constructor
                const { jsPDF } = window.jspdf || window;
                
                const area = width * height;
                const total = area * material.price;
                
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(24);
                doc.setTextColor(0, 100, 200);
                doc.text('PAPEL E ARTE', 20, 25);
                
                doc.setFontSize(12);
                doc.setTextColor(100, 100, 100);
                doc.text('Comunicacao Visual', 20, 35);
                
                // Title
                doc.setFontSize(18);
                doc.setTextColor(0, 0, 0);
                doc.text('ORCAMENTO', 20, 55);
                
                // Date and quote number
                doc.setFontSize(10);
                doc.text('Data: ' + new Date().toLocaleDateString('pt-BR'), 20, 70);
                doc.text('Orcamento No: ' + Date.now().toString().slice(-6), 20, 80);
                
                // Material details
                doc.setFontSize(12);
                doc.text('DETALHES DO MATERIAL:', 20, 100);
                
                doc.setFontSize(10);
                const unit = document.querySelector('input[name="measurementUnit"]:checked').value;
                const unitDisplay = unit === 'centimeters' ? 'cm' : 'm';
                
                doc.text('Material: ' + material.name, 25, 115);
                doc.text('Descricao: ' + material.description, 25, 125);
                doc.text('Dimensoes: ' + width + unitDisplay + ' x ' + height + unitDisplay, 25, 135);
                doc.text('Area Total: ' + area.toFixed(2) + ' m¬≤', 25, 145);
                doc.text('Preco por m¬≤: R$ ' + material.price.toFixed(2), 25, 155);
                
                // Total
                doc.setFontSize(14);
                doc.setTextColor(200, 0, 0);
                doc.text('VALOR TOTAL: R$ ' + total.toFixed(2), 25, 175);
                
                // Notes
                if (notes) {
                    doc.setFontSize(10);
                    doc.setTextColor(0, 0, 0);
                    doc.text('OBSERVACOES:', 20, 195);
                    
                    const splitNotes = doc.splitTextToSize(notes, 170);
                    doc.text(splitNotes, 25, 205);
                }
                
                // Footer
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text('Este orcamento tem validade de 15 dias.', 20, 270);
                doc.text('Papel e Arte - Comunicacao Visual', 20, 280);
                
                // Save PDF
                const fileName = 'orcamento-' + material.name.replace(/\s+/g, '-').toLowerCase() + '-' + Date.now() + '.pdf';
                doc.save(fileName);
                
                showNotification('Or√ßamento PDF gerado com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showNotification('Erro ao gerar PDF. Verifique se o navegador permite downloads.', 'error');
            }
        }



        // Settings Functions
        function loadSystemSettings() {
            if (!localStorage.getItem('pdv_system_settings')) {
                systemSettings = {
                    companyName: 'Sistema Papel e Arte',
                    companySlogan: 'Comunica√ß√£o Visual',
                    companyPhone: '',
                    companyEmail: '',
                    receiptFooter: 'Obrigado pela prefer√™ncia!',
                    showLogoOnReceipt: false,
                    defaultCurrency: 'BRL',
                    autoBackup: false,
                    soundNotifications: true
                };
                localStorage.setItem('pdv_system_settings', JSON.stringify(systemSettings));
            } else {
                systemSettings = JSON.parse(localStorage.getItem('pdv_system_settings'));
            }
            
            // Load company logo
            companyLogo = localStorage.getItem('pdv_company_logo');
            
            // Apply settings to UI
            applySystemSettings();
            
            // Update last backup date display
            updateLastBackupDate();
        }

        function applySystemSettings() {
            // Update company name in header
            const headerTitle = document.querySelector('nav h1');
            if (headerTitle) {
                headerTitle.textContent = systemSettings.companyName || 'Sistema Papel e Arte';
            }
            
            // Update logo in header
            const logoContainer = document.querySelector('nav .bg-blue-500');
            if (companyLogo && logoContainer) {
                logoContainer.innerHTML = `<img src="${companyLogo}" alt="Logo" class="w-8 h-8 object-contain">`;
            }
            
            // Load settings into form fields
            if (document.getElementById('companyName')) {
                document.getElementById('companyName').value = systemSettings.companyName || '';
                document.getElementById('companySlogan').value = systemSettings.companySlogan || '';
                document.getElementById('companyPhone').value = systemSettings.companyPhone || '';
                document.getElementById('companyEmail').value = systemSettings.companyEmail || '';
                document.getElementById('receiptFooter').value = systemSettings.receiptFooter || '';
                document.getElementById('showLogoOnReceipt').checked = systemSettings.showLogoOnReceipt || false;
                document.getElementById('defaultCurrency').value = systemSettings.defaultCurrency || 'BRL';
                document.getElementById('autoBackup').checked = systemSettings.autoBackup || false;
                document.getElementById('soundNotifications').checked = systemSettings.soundNotifications || true;
            }
            
            // Update logo preview
            updateLogoPreview();
        }

        function updateLogoPreview() {
            const logoPreview = document.getElementById('logoPreview');
            if (logoPreview) {
                if (companyLogo) {
                    logoPreview.innerHTML = `<img src="${companyLogo}" alt="Logo" class="w-16 h-16 object-contain rounded-lg">`;
                } else {
                    logoPreview.innerHTML = `
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                        </svg>
                    `;
                }
            }
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check file size (max 2MB)
            if (file.size > 2 * 1024 * 1024) {
                showNotification('Arquivo muito grande! M√°ximo 2MB.', 'error');
                return;
            }
            
            // Check file type
            if (!file.type.startsWith('image/')) {
                showNotification('Apenas arquivos de imagem s√£o permitidos!', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                companyLogo = e.target.result;
                localStorage.setItem('pdv_company_logo', companyLogo);
                updateLogoPreview();
                applySystemSettings(); // Update header logo
                showNotification('Logo carregado com sucesso!', 'success');
            };
            reader.readAsDataURL(file);
        }

        function resetLogo() {
            if (confirm('Tem certeza que deseja resetar o logo para o padr√£o do sistema?')) {
                companyLogo = null;
                localStorage.removeItem('pdv_company_logo');
                updateLogoPreview();
                applySystemSettings(); // Update header logo
                showNotification('Logo resetado para o padr√£o do sistema!', 'success');
            }
        }

        function removeLogo() {
            if (confirm('Tem certeza que deseja remover o logo?')) {
                companyLogo = null;
                localStorage.removeItem('pdv_company_logo');
                updateLogoPreview();
                applySystemSettings(); // Update header logo
                showNotification('Logo removido!', 'success');
            }
        }

        function saveSystemSettings() {
            systemSettings = {
                companyName: document.getElementById('companyName').value,
                companySlogan: document.getElementById('companySlogan').value,
                companyPhone: document.getElementById('companyPhone').value,
                companyEmail: document.getElementById('companyEmail').value,
                receiptFooter: systemSettings.receiptFooter,
                showLogoOnReceipt: systemSettings.showLogoOnReceipt,
                defaultCurrency: systemSettings.defaultCurrency,
                autoBackup: systemSettings.autoBackup,
                soundNotifications: systemSettings.soundNotifications
            };
            
            localStorage.setItem('pdv_system_settings', JSON.stringify(systemSettings));
            applySystemSettings();
            showNotification('Configura√ß√µes salvas com sucesso!', 'success');
        }

        function saveAdvancedSettings() {
            systemSettings.receiptFooter = document.getElementById('receiptFooter').value;
            systemSettings.showLogoOnReceipt = document.getElementById('showLogoOnReceipt').checked;
            systemSettings.defaultCurrency = document.getElementById('defaultCurrency').value;
            systemSettings.autoBackup = document.getElementById('autoBackup').checked;
            systemSettings.soundNotifications = document.getElementById('soundNotifications').checked;
            
            localStorage.setItem('pdv_system_settings', JSON.stringify(systemSettings));
            showNotification('Configura√ß√µes avan√ßadas salvas!', 'success');
        }

        // Store Management Functions
        function loadStoresList() {
            const container = document.getElementById('storesList');
            if (!container) return;
            
            container.innerHTML = '';
            
            stores.forEach(store => {
                const storeDiv = document.createElement('div');
                storeDiv.className = 'bg-gray-50 p-4 rounded-lg border';
                storeDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-800">${store.name}</h4>
                            <p class="text-sm text-gray-600 mt-1">${store.address}</p>
                            ${store.phone ? `<p class="text-sm text-gray-500">üìû ${store.phone}</p>` : ''}
                            ${store.email ? `<p class="text-sm text-gray-500">üìß ${store.email}</p>` : ''}
                            ${store.manager ? `<p class="text-sm text-gray-500">üë§ ${store.manager}</p>` : ''}
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="editStore(${store.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                ‚úèÔ∏è Editar
                            </button>
                            <button onclick="deleteStore(${store.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                                üóëÔ∏è Deletar
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(storeDiv);
            });
        }

        function showStoreForm() {
            editingStoreId = null;
            document.getElementById('storeModalTitle').textContent = 'Nova Loja';
            document.getElementById('storeName').value = '';
            document.getElementById('storeAddress').value = '';
            document.getElementById('storePhone').value = '';
            document.getElementById('storeEmail').value = '';
            document.getElementById('storeManager').value = '';
            document.getElementById('storeModal').classList.remove('hidden');
        }

        function hideStoreForm() {
            document.getElementById('storeModal').classList.add('hidden');
        }

        function editStore(id) {
            const store = stores.find(s => s.id === id);
            if (store) {
                editingStoreId = id;
                document.getElementById('storeModalTitle').textContent = 'Editar Loja';
                document.getElementById('storeName').value = store.name;
                document.getElementById('storeAddress').value = store.address;
                document.getElementById('storePhone').value = store.phone || '';
                document.getElementById('storeEmail').value = store.email || '';
                document.getElementById('storeManager').value = store.manager || '';
                document.getElementById('storeModal').classList.remove('hidden');
            }
        }

        function saveStore(event) {
            event.preventDefault();
            
            const storeData = {
                name: document.getElementById('storeName').value,
                address: document.getElementById('storeAddress').value,
                phone: document.getElementById('storePhone').value,
                email: document.getElementById('storeEmail').value,
                manager: document.getElementById('storeManager').value
            };
            
            if (editingStoreId) {
                const index = stores.findIndex(s => s.id === editingStoreId);
                stores[index] = { ...stores[index], ...storeData };
                showNotification('Loja atualizada com sucesso!', 'success');
            } else {
                const newId = Math.max(...stores.map(s => s.id), 0) + 1;
                stores.push({ id: newId, ...storeData });
                showNotification('Loja cadastrada com sucesso!', 'success');
            }
            
            localStorage.setItem('pdv_stores', JSON.stringify(stores));
            loadStores(); // Reload store selector
            loadStoresList(); // Reload stores list
            hideStoreForm();
        }

        function deleteStore(id) {
            if (stores.length <= 1) {
                showNotification('N√£o √© poss√≠vel deletar a √∫nica loja do sistema!', 'error');
                return;
            }
            
            if (confirm('Tem certeza que deseja deletar esta loja? Todos os dados relacionados ser√£o perdidos!')) {
                stores = stores.filter(s => s.id !== id);
                
                // Remove employees from deleted store
                employees = employees.filter(e => e.storeId !== id);
                
                // Remove products from deleted store
                products = products.filter(p => !p.storeId || p.storeId !== id);
                
                // Remove sales from deleted store
                sales = sales.filter(s => s.storeId !== id);
                
                localStorage.setItem('pdv_stores', JSON.stringify(stores));
                localStorage.setItem('pdv_employees', JSON.stringify(employees));
                localStorage.setItem('pdv_products', JSON.stringify(products));
                localStorage.setItem('pdv_sales', JSON.stringify(sales));
                
                // If current store was deleted, switch to first available
                if (currentStore === id) {
                    currentStore = stores[0].id;
                }
                
                loadStores();
                loadStoresList();
                loadEmployees();
                loadProducts();
                loadSalesHistory();
                showNotification('Loja deletada com sucesso!', 'success');
            }
        }

        // Data Management Functions
        function exportAllData() {
            const allData = {
                stores: stores,
                products: products,
                employees: employees,
                sales: sales,
                stockMovements: stockMovements,
                materials: materials,
                systemSettings: systemSettings,
                companyLogo: companyLogo,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `backup-completo-papel-arte-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            // Update last backup date
            localStorage.setItem('pdv_last_backup', new Date().toISOString());
            updateLastBackupDate();
            
            showNotification('Backup completo exportado com sucesso!', 'success');
        }

        function exportProducts() {
            const productsData = {
                products: products,
                materials: materials,
                stockMovements: stockMovements.filter(m => m.type === 'entrada' || m.type === 'saida'),
                exportDate: new Date().toISOString(),
                exportType: 'products',
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(productsData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `backup-produtos-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Backup de produtos exportado com sucesso!', 'success');
        }

        function exportReports() {
            const reportsData = {
                sales: sales,
                stockMovements: stockMovements,
                salesSummary: generateSalesSummaryData(),
                exportDate: new Date().toISOString(),
                exportType: 'reports',
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(reportsData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `backup-relatorios-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Backup de relat√≥rios exportado com sucesso!', 'success');
        }

        function generateSalesSummaryData() {
            const today = new Date();
            const todayStr = today.toDateString();
            
            // Calculate summaries for all stores
            const summaryByStore = {};
            
            stores.forEach(store => {
                const storeSales = sales.filter(sale => sale.storeId === store.id);
                
                const todaySales = storeSales.filter(sale => new Date(sale.date).toDateString() === todayStr);
                const todayTotal = todaySales.reduce((sum, sale) => sum + sale.total, 0);
                
                const weekStart = new Date(today);
                weekStart.setDate(today.getDate() - today.getDay());
                const weekSales = storeSales.filter(sale => new Date(sale.date) >= weekStart);
                const weekTotal = weekSales.reduce((sum, sale) => sum + sale.total, 0);
                
                const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                const monthSales = storeSales.filter(sale => new Date(sale.date) >= monthStart);
                const monthTotal = monthSales.reduce((sum, sale) => sum + sale.total, 0);
                
                summaryByStore[store.id] = {
                    storeName: store.name,
                    today: { sales: todaySales.length, total: todayTotal },
                    week: { sales: weekSales.length, total: weekTotal },
                    month: { sales: monthSales.length, total: monthTotal }
                };
            });
            
            return summaryByStore;
        }

        function importData() {
            document.getElementById('importFile').click();
        }

        function importProducts() {
            document.getElementById('importProductsFile').click();
        }

        function importReports() {
            document.getElementById('importReportsFile').click();
        }

        function handleDataImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (confirm('Tem certeza que deseja restaurar o sistema completo? Isso substituir√° todos os dados atuais!')) {
                        // Import all data
                        if (importedData.stores) {
                            stores = importedData.stores;
                            localStorage.setItem('pdv_stores', JSON.stringify(stores));
                        }
                        
                        if (importedData.products) {
                            products = importedData.products;
                            localStorage.setItem('pdv_products', JSON.stringify(products));
                        }
                        
                        if (importedData.employees) {
                            employees = importedData.employees;
                            localStorage.setItem('pdv_employees', JSON.stringify(employees));
                        }
                        
                        if (importedData.sales) {
                            sales = importedData.sales;
                            localStorage.setItem('pdv_sales', JSON.stringify(sales));
                        }
                        
                        if (importedData.stockMovements) {
                            stockMovements = importedData.stockMovements;
                            localStorage.setItem('pdv_stock_movements', JSON.stringify(stockMovements));
                        }
                        
                        if (importedData.materials) {
                            materials = importedData.materials;
                            localStorage.setItem('pdv_materials', JSON.stringify(materials));
                        }
                        
                        if (importedData.systemSettings) {
                            systemSettings = importedData.systemSettings;
                            localStorage.setItem('pdv_system_settings', JSON.stringify(systemSettings));
                        }
                        
                        if (importedData.companyLogo) {
                            companyLogo = importedData.companyLogo;
                            localStorage.setItem('pdv_company_logo', companyLogo);
                        }
                        
                        // Reload everything
                        initSystem();
                        showNotification('Sistema restaurado com sucesso! Recarregando...', 'success');
                        
                        setTimeout(() => {
                            location.reload();
                        }, 2000);
                    }
                } catch (error) {
                    showNotification('Erro ao restaurar sistema! Arquivo inv√°lido.', 'error');
                }
            };
            reader.readAsText(file);
        }

        function handleProductsImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.exportType !== 'products') {
                        showNotification('Arquivo inv√°lido! Este n√£o √© um backup de produtos.', 'error');
                        return;
                    }
                    
                    if (confirm('Tem certeza que deseja importar os produtos? Isso substituir√° todos os produtos atuais!')) {
                        if (importedData.products) {
                            products = importedData.products;
                            localStorage.setItem('pdv_products', JSON.stringify(products));
                        }
                        
                        if (importedData.materials) {
                            materials = importedData.materials;
                            localStorage.setItem('pdv_materials', JSON.stringify(materials));
                        }
                        
                        if (importedData.stockMovements) {
                            stockMovements = importedData.stockMovements;
                            localStorage.setItem('pdv_stock_movements', JSON.stringify(stockMovements));
                        }
                        
                        // Reload products data
                        loadProducts();
                        loadQuoteProducts();
                        loadMaterials();
                        loadStockMovements();
                        updateLowStockAlerts();
                        
                        showNotification('Produtos importados com sucesso!', 'success');
                    }
                } catch (error) {
                    showNotification('Erro ao importar produtos! Arquivo inv√°lido.', 'error');
                }
            };
            reader.readAsText(file);
        }

        function handleReportsImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.exportType !== 'reports') {
                        showNotification('Arquivo inv√°lido! Este n√£o √© um backup de relat√≥rios.', 'error');
                        return;
                    }
                    
                    if (confirm('Tem certeza que deseja importar os relat√≥rios? Isso substituir√° todo o hist√≥rico atual!')) {
                        if (importedData.sales) {
                            sales = importedData.sales;
                            localStorage.setItem('pdv_sales', JSON.stringify(sales));
                        }
                        
                        if (importedData.stockMovements) {
                            stockMovements = importedData.stockMovements;
                            localStorage.setItem('pdv_stock_movements', JSON.stringify(stockMovements));
                        }
                        
                        // Reload reports data
                        loadSalesHistory();
                        loadStockMovements();
                        updateSalesSummary();
                        
                        showNotification('Relat√≥rios importados com sucesso!', 'success');
                    }
                } catch (error) {
                    showNotification('Erro ao importar relat√≥rios! Arquivo inv√°lido.', 'error');
                }
            };
            reader.readAsText(file);
        }

        function scheduleAutoBackup() {
            // Perform automatic backup
            const backupData = {
                products: products,
                sales: sales.slice(-100), // Last 100 sales only
                stockMovements: stockMovements.slice(-50), // Last 50 movements only
                materials: materials,
                exportDate: new Date().toISOString(),
                exportType: 'auto_backup',
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `backup-automatico-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            // Update last backup date
            localStorage.setItem('pdv_last_backup', new Date().toISOString());
            updateLastBackupDate();
            
            showNotification('Backup autom√°tico gerado com sucesso!', 'success');
        }

        function updateLastBackupDate() {
            const lastBackup = localStorage.getItem('pdv_last_backup');
            const lastBackupElement = document.getElementById('lastBackupDate');
            
            if (lastBackupElement) {
                if (lastBackup) {
                    const date = new Date(lastBackup);
                    lastBackupElement.textContent = date.toLocaleString('pt-BR');
                } else {
                    lastBackupElement.textContent = 'Nunca';
                }
            }
        }

        function resetAllData() {
            if (confirm('ATEN√á√ÉO: Isso ir√° apagar TODOS os dados do sistema! Tem certeza?')) {
                if (confirm('Esta a√ß√£o √© IRREVERS√çVEL! Confirma novamente?')) {
                    // Clear all localStorage
                    localStorage.removeItem('pdv_stores');
                    localStorage.removeItem('pdv_products');
                    localStorage.removeItem('pdv_employees');
                    localStorage.removeItem('pdv_sales');
                    localStorage.removeItem('pdv_stock_movements');
                    localStorage.removeItem('pdv_materials');
                    localStorage.removeItem('pdv_system_settings');
                    localStorage.removeItem('pdv_company_logo');
                    localStorage.removeItem('pdv_last_backup');
                    
                    showNotification('Sistema resetado! Recarregando...', 'success');
                    
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                }
            }
        }

        // Initialize system on page load
        document.addEventListener('DOMContentLoaded', function() {
            initSystem();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97e91feb64cb9ca3',t:'MTc1Nzc4MjAyOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>